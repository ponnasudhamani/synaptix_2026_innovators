<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PulseIQ Pro ‚Äî Advanced Health Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,500;0,9..144,700;1,9..144,300&family=Instrument+Sans:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --cream:#F5F0E8;--cream2:#EDE8DC;--cream3:#E2DBCC;
  --ink:#1A1410;--ink2:#3D3530;--ink3:#6B5E56;
  --teal:#0A7B6C;--teal2:#0D9982;--teal-lt:#E0F4F1;--teal-mid:#B8E8E2;
  --amber:#C97B1A;--amber-lt:#FEF3E2;
  --red:#C0392B;--red-lt:#FDECEA;--red-mid:#F5C6C2;
  --green:#1A7B4A;--green-lt:#E6F4EE;
  --blue:#1A5C9C;--blue-lt:#E6EEF8;
  --purple:#7B1A9C;--purple-lt:#F3E6F8;
  --orange:#B85A00;
  --border:rgba(26,20,16,.1);--border2:rgba(26,20,16,.18);
  --shadow:0 1px 3px rgba(26,20,16,.08),0 4px 12px rgba(26,20,16,.05);
  --shadow-lg:0 4px 16px rgba(26,20,16,.1),0 12px 40px rgba(26,20,16,.06);
  --r:12px;--r2:8px;
  --ff-head:'Fraunces',Georgia,serif;--ff-body:'Instrument Sans',system-ui,sans-serif;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:15px;scroll-behavior:smooth}
body{background:var(--cream);color:var(--ink);font-family:var(--ff-body);min-height:100vh;-webkit-font-smoothing:antialiased}

/* ‚ïê‚ïê‚ïê LAYOUT ‚ïê‚ïê‚ïê */
.app-shell{display:flex;min-height:100vh}
.nav{width:224px;flex-shrink:0;background:var(--ink);display:flex;flex-direction:column;position:sticky;top:0;height:100vh;overflow:hidden}
.nav-brand{padding:26px 22px 20px;border-bottom:1px solid rgba(255,255,255,.08)}
.nav-brand-name{font-family:var(--ff-head);font-size:1.4rem;font-weight:700;color:#fff;letter-spacing:-.01em}
.nav-brand-sub{font-size:.68rem;color:rgba(255,255,255,.38);margin-top:2px;letter-spacing:.06em;text-transform:uppercase}
.nav-patient{margin:14px 12px;padding:11px;background:rgba(255,255,255,.06);border-radius:var(--r2);display:flex;align-items:center;gap:9px;cursor:pointer;transition:background .15s}
.nav-patient:hover{background:rgba(255,255,255,.1)}
.nav-avatar{width:34px;height:34px;border-radius:50%;background:var(--teal2);display:flex;align-items:center;justify-content:center;font-family:var(--ff-head);font-size:.85rem;font-weight:700;color:#fff;flex-shrink:0}
.nav-patient-name{font-size:.8rem;font-weight:600;color:#fff;line-height:1.2}
.nav-patient-id{font-size:.66rem;color:rgba(255,255,255,.38)}
.nav-links{flex:1;padding:8px 10px;display:flex;flex-direction:column;gap:2px;overflow-y:auto}
.nav-link{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--r2);color:rgba(255,255,255,.55);font-size:.8rem;font-weight:500;cursor:pointer;transition:all .15s;border:none;background:none;width:100%;text-align:left}
.nav-link:hover{color:#fff;background:rgba(255,255,255,.07)}
.nav-link.active{color:#fff;background:var(--teal)}
.nav-link .icon{font-size:.95rem;width:20px;text-align:center;flex-shrink:0}
.nav-badge{margin-left:auto;padding:1px 7px;border-radius:20px;background:var(--red);color:#fff;font-size:.6rem;font-weight:700;display:none}
.nav-badge.show{display:block}
.nav-section-label{font-size:.6rem;color:rgba(255,255,255,.25);letter-spacing:.08em;text-transform:uppercase;padding:14px 12px 4px;font-weight:600}
.nav-footer{padding:14px 12px;border-top:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;gap:8px}
.live-chip{display:flex;align-items:center;gap:8px;padding:7px 11px;background:rgba(10,123,108,.22);border:1px solid rgba(10,123,108,.38);border-radius:var(--r2);font-size:.7rem;color:var(--teal2);font-weight:600}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--teal2);box-shadow:0 0 6px var(--teal2);animation:livepulse 1.8s ease-in-out infinite;flex-shrink:0}
.mic-chip{display:flex;align-items:center;gap:8px;padding:7px 11px;background:rgba(123,26,156,.22);border:1px solid rgba(123,26,156,.38);border-radius:var(--r2);font-size:.7rem;color:#c46be8;font-weight:600;cursor:pointer;transition:all .2s}
.mic-chip:hover{background:rgba(123,26,156,.35)}
.mic-chip.listening{background:rgba(123,26,156,.4);border-color:rgba(123,26,156,.8)}
.mic-dot{width:7px;height:7px;border-radius:50%;background:#c46be8;box-shadow:0 0 6px #c46be8;flex-shrink:0}
@keyframes livepulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.7)}}
.main-content{flex:1;overflow:hidden;display:flex;flex-direction:column}
.page{display:none;flex:1;overflow-y:auto}
.page.active{display:flex;flex-direction:column}
.page-header{padding:26px 30px 0;display:flex;align-items:flex-start;justify-content:space-between;flex-shrink:0}
.page-title{font-family:var(--ff-head);font-size:1.75rem;font-weight:500;color:var(--ink);letter-spacing:-.02em;line-height:1.2}
.page-subtitle{font-size:.8rem;color:var(--ink3);margin-top:4px}
.page-actions{display:flex;align-items:center;gap:8px}
.btn{padding:8px 16px;border-radius:var(--r2);font-family:var(--ff-body);font-size:.8rem;font-weight:600;cursor:pointer;transition:all .15s;border:none;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:var(--teal);color:#fff}
.btn-primary:hover{background:var(--teal2)}
.btn-danger{background:var(--red);color:#fff}
.btn-danger:hover{background:#a93226}
.btn-ghost{background:transparent;border:1.5px solid var(--border2);color:var(--ink2)}
.btn-ghost:hover{border-color:var(--ink3);background:var(--cream2)}
.btn-sm{padding:5px 11px;font-size:.74rem}
.btn-purple{background:var(--purple);color:#fff}
.btn-purple:hover{background:#9b22c2}

/* ‚ïê‚ïê‚ïê MONITOR PAGE ‚ïê‚ïê‚ïê */
.monitor-body{padding:22px 30px 30px;display:grid;grid-template-columns:1fr 310px;gap:18px;flex:1}
.hri-hero{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:26px;display:flex;align-items:center;gap:28px;grid-column:1/-1;position:relative;overflow:hidden}
.hri-hero::before{content:'';position:absolute;right:-60px;top:-60px;width:250px;height:250px;border-radius:50%;background:var(--teal-lt);opacity:.45}
.hri-gauge-box{position:relative;flex-shrink:0}
.hri-score-num{position:absolute;top:50%;left:50%;transform:translate(-50%,-44%);font-family:var(--ff-head);font-size:2.8rem;font-weight:700;line-height:1;transition:color .5s}
.hri-score-label{position:absolute;bottom:16%;left:50%;transform:translateX(-50%);font-size:.62rem;font-weight:600;color:var(--ink3);letter-spacing:.08em;text-transform:uppercase;white-space:nowrap}
.hri-hero-info{flex:1;position:relative;z-index:1}
.hri-status-badge{display:inline-flex;align-items:center;gap:7px;padding:5px 14px;border-radius:20px;font-size:.76rem;font-weight:700;letter-spacing:.04em;margin-bottom:10px;transition:all .4s}
.hri-hero-title{font-family:var(--ff-head);font-size:1.4rem;font-weight:500;color:var(--ink);line-height:1.3;margin-bottom:7px}
.hri-hero-desc{font-size:.82rem;color:var(--ink3);line-height:1.6;max-width:440px}
.hri-meta{display:flex;gap:20px;margin-top:14px;flex-wrap:wrap}
.hri-meta-item{display:flex;flex-direction:column;gap:2px}
.hri-meta-val{font-family:var(--ff-head);font-size:1.05rem;font-weight:500;color:var(--ink)}
.hri-meta-lbl{font-size:.65rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.06em}

/* Signal grid */
.signal-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;grid-column:1}
.sig-card{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:14px 16px 12px;position:relative;overflow:hidden;transition:box-shadow .2s,border-color .3s}
.sig-card:hover{box-shadow:var(--shadow-lg)}
.sig-card.alert-anim{border-color:var(--red);animation:card-pulse 2s ease infinite}
@keyframes card-pulse{0%,100%{box-shadow:var(--shadow)}50%{box-shadow:0 0 0 3px rgba(192,57,43,.15),var(--shadow-lg)}}
.sig-card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.sig-icon{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0}
.sig-status-dot{width:7px;height:7px;border-radius:50%;background:var(--green)}
.sig-name{font-size:.68rem;font-weight:600;color:var(--ink3);letter-spacing:.04em;text-transform:uppercase;margin-bottom:1px}
.sig-val-row{display:flex;align-items:baseline;gap:4px;margin-bottom:8px}
.sig-val{font-family:var(--ff-head);font-size:1.8rem;font-weight:500;line-height:1;transition:color .3s}
.sig-unit{font-size:.72rem;color:var(--ink3);font-weight:500}
.sig-range{font-size:.65rem;color:var(--ink3);margin-bottom:6px}
.sig-bar-track{height:4px;border-radius:2px;background:var(--cream2);overflow:hidden}
.sig-bar-fill{height:100%;border-radius:2px;transition:width .4s ease,background .4s}
.sig-mini-wrap{height:34px;margin-top:7px}
canvas.sig-mini{display:block;width:100%;height:34px}
.sig-trend{font-size:.62rem;color:var(--ink3);margin-top:5px;display:flex;align-items:center;gap:3px}

/* Right column */
.monitor-right{display:flex;flex-direction:column;gap:12px}
.alert-banner{border-radius:var(--r);padding:14px;background:#fff;border:1px solid var(--border);box-shadow:var(--shadow);display:none}
.alert-banner.show{display:block}
.alert-banner-top{display:flex;align-items:center;gap:8px;margin-bottom:5px}
.alert-banner-icon{font-size:1.1rem}
.alert-banner-level{font-size:.72rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase}
.alert-banner-time{font-size:.65rem;color:var(--ink3);margin-left:auto}
.alert-banner-msg{font-size:.78rem;color:var(--ink2);line-height:1.5}
.alert-banner-signals{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px}
.signal-chip{padding:2px 8px;border-radius:20px;font-size:.65rem;font-weight:600;background:var(--cream2);color:var(--ink2)}
.widget{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:16px}
.widget-title{font-size:.7rem;font-weight:600;color:var(--ink3);letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}
.corr-heatmap{display:grid;gap:3px}
.corr-cell{aspect-ratio:1;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:.5rem;font-weight:700;transition:all .5s;cursor:default}
.corr-row-label{font-size:.55rem;color:var(--ink3);display:flex;align-items:center;justify-content:center;font-weight:600}
.corr-col-labels{gap:3px;margin-top:3px}
.corr-col-label{font-size:.52rem;color:var(--ink3);text-align:center;font-weight:600}
.scenario-btns{display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:8px}
.scenario-btn{padding:6px 7px;border-radius:var(--r2);font-size:.7rem;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:var(--cream);color:var(--ink2);transition:all .15s;text-align:center}
.scenario-btn:hover{border-color:var(--teal);color:var(--teal);background:var(--teal-lt)}
.scenario-btn.active{border-color:var(--teal);background:var(--teal);color:#fff}
.scenario-btn.full{grid-column:1/-1}

/* ‚ïê‚ïê‚ïê MIC ANALYSIS WIDGET ‚ïê‚ïê‚ïê */
.mic-widget{background:linear-gradient(135deg,#2D1B42,#1A1028);border-radius:var(--r);border:1px solid rgba(196,107,232,.25);box-shadow:var(--shadow);padding:16px;position:relative;overflow:hidden}
.mic-widget::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;border-radius:50%;background:rgba(196,107,232,.08)}
.mic-widget-title{font-size:.7rem;font-weight:600;color:rgba(255,255,255,.6);letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.mic-widget-title span{color:#c46be8}
.mic-visualizer{height:42px;background:rgba(255,255,255,.04);border-radius:8px;overflow:hidden;margin-bottom:10px;position:relative}
.mic-canvas{display:block;width:100%;height:42px}
.mic-detections{display:flex;flex-direction:column;gap:4px}
.mic-det-row{display:flex;align-items:center;justify-content:space-between;padding:5px 9px;border-radius:6px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06)}
.mic-det-label{font-size:.7rem;color:rgba(255,255,255,.7);display:flex;align-items:center;gap:5px}
.mic-det-conf{font-size:.7rem;font-weight:700;color:#c46be8}
.mic-det-bar{flex:1;height:4px;background:rgba(255,255,255,.08);border-radius:2px;margin:0 10px;overflow:hidden}
.mic-det-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,#7B1A9C,#c46be8);transition:width .5s ease}
.mic-start-btn{width:100%;padding:8px;border:none;border-radius:8px;background:rgba(123,26,156,.5);border:1px solid rgba(196,107,232,.35);color:#c46be8;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--ff-body);margin-top:8px;display:flex;align-items:center;justify-content:center;gap:6px}
.mic-start-btn:hover{background:rgba(123,26,156,.7)}
.mic-start-btn.active{background:rgba(192,57,43,.5);border-color:rgba(192,57,43,.6);color:#f0a0a0}

/* ‚ïê‚ïê‚ïê STEP COUNT CARD ‚ïê‚ïê‚ïê */
.steps-ring-container{display:flex;align-items:center;gap:14px;margin-top:2px}
.steps-info{flex:1}
.steps-val{font-family:var(--ff-head);font-size:2rem;font-weight:600;color:var(--teal);line-height:1}
.steps-goal{font-size:.7rem;color:var(--ink3);margin-top:2px}
.steps-badges{display:flex;gap:4px;flex-wrap:wrap;margin-top:7px}
.steps-badge{padding:2px 8px;border-radius:12px;font-size:.64rem;font-weight:600}

/* ‚ïê‚ïê‚ïê FEVER / BODY TEMP GAUGE ‚ïê‚ïê‚ïê */
.fever-card{background:linear-gradient(135deg,#fff8ee,#fff);border-radius:var(--r);border:1px solid rgba(201,123,26,.2);box-shadow:var(--shadow);padding:16px}
.fever-zones{display:flex;gap:4px;margin:10px 0;height:8px;border-radius:4px;overflow:hidden}
.fever-zone{flex:1;transition:opacity .3s}
.fever-zone.active-zone{position:relative;box-shadow:0 0 8px currentColor}
.fever-arrow{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;transition:margin-left .5s ease}
.fever-labels{display:flex;justify-content:space-between;font-size:.58rem;color:var(--ink3);margin-top:4px}
.fever-status{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-size:.74rem;font-weight:700;margin-top:8px}

/* ‚ïê‚ïê‚ïê ALERTS PAGE ‚ïê‚ïê‚ïê */
.alerts-body{padding:22px 30px 40px;display:flex;flex-direction:column;gap:18px}
.alert-stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.stat-card{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:16px 18px}
.stat-card-val{font-family:var(--ff-head);font-size:1.9rem;font-weight:500;line-height:1;color:var(--ink);margin-bottom:3px}
.stat-card-lbl{font-size:.7rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em}
.alert-filter-row{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.filter-chip{padding:5px 12px;border-radius:20px;font-size:.73rem;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:#fff;color:var(--ink2);transition:all .15s}
.filter-chip.active{border-color:var(--teal);background:var(--teal-lt);color:var(--teal)}
.filter-chip:hover{border-color:var(--teal)}
.alert-list{display:flex;flex-direction:column;gap:9px}
.alert-row{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:14px 18px;display:flex;align-items:flex-start;gap:14px;cursor:pointer;transition:box-shadow .15s}
.alert-row:hover{box-shadow:var(--shadow-lg)}
.alert-row-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;margin-top:2px}
.alert-row-body{flex:1;min-width:0}
.alert-row-top{display:flex;align-items:center;gap:7px;margin-bottom:3px}
.alert-row-level{font-size:.68rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;padding:2px 8px;border-radius:20px}
.alert-row-hri{font-size:.7rem;font-weight:700;color:var(--ink2)}
.alert-row-time{margin-left:auto;font-size:.7rem;color:var(--ink3)}
.alert-row-title{font-size:.85rem;font-weight:600;color:var(--ink);margin-bottom:2px}
.alert-row-desc{font-size:.75rem;color:var(--ink3);line-height:1.5}
.alert-row-signals{display:flex;gap:5px;flex-wrap:wrap;margin-top:7px}

/* ‚ïê‚ïê‚ïê HISTORY PAGE ‚ïê‚ïê‚ïê */
.history-body{padding:22px 30px 40px;display:flex;flex-direction:column;gap:18px}
.history-tabs{display:flex;gap:0;background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:4px;width:fit-content}
.history-tab{padding:6px 18px;border-radius:var(--r2);font-size:.78rem;font-weight:600;cursor:pointer;color:var(--ink3);border:none;background:none;transition:all .15s}
.history-tab.active{background:var(--teal);color:#fff}
.history-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.history-card{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:18px}
.history-card-full{grid-column:1/-1}
.history-card-title{font-family:var(--ff-head);font-size:.95rem;font-weight:500;color:var(--ink);margin-bottom:3px}
.history-card-sub{font-size:.72rem;color:var(--ink3);margin-bottom:14px}
canvas.history-chart{display:block;width:100%;border-radius:6px}
.trend-indicators{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-top:12px}
.trend-item{padding:11px;background:var(--cream);border-radius:var(--r2);text-align:center}
.trend-val{font-family:var(--ff-head);font-size:1.25rem;font-weight:500;color:var(--ink);margin-bottom:2px}
.trend-lbl{font-size:.65rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em}
.pattern-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.pattern-card{padding:12px;border-radius:var(--r2);border:1px solid var(--border)}
.pattern-card-title{font-size:.76rem;font-weight:600;color:var(--ink);margin-bottom:3px}
.pattern-card-body{font-size:.7rem;color:var(--ink3);line-height:1.5}
.daily-summary{display:flex;flex-direction:column;gap:7px}
.day-row{display:flex;align-items:center;gap:10px;padding:9px 12px;background:var(--cream);border-radius:var(--r2)}
.day-label{font-size:.78rem;font-weight:600;color:var(--ink);width:80px;flex-shrink:0}
.day-bar-track{flex:1;height:8px;border-radius:4px;background:var(--cream2);overflow:hidden}
.day-bar-fill{height:100%;border-radius:4px;transition:width 1s ease}
.day-score{font-size:.76rem;font-weight:700;width:32px;text-align:right;flex-shrink:0}
.day-events{font-size:.68rem;color:var(--ink3);width:80px;text-align:right;flex-shrink:0}

/* ‚ïê‚ïê‚ïê SETTINGS PAGE ‚ïê‚ïê‚ïê */
.settings-body{padding:22px 30px 40px;display:grid;grid-template-columns:300px 1fr;gap:20px;align-items:start}
.settings-nav{display:flex;flex-direction:column;gap:4px}
.settings-nav-item{padding:10px 14px;border-radius:var(--r2);font-size:.82rem;font-weight:500;cursor:pointer;border:none;background:none;text-align:left;color:var(--ink2);transition:all .15s;font-family:var(--ff-body);display:flex;align-items:center;gap:8px}
.settings-nav-item:hover{background:var(--cream2);color:var(--ink)}
.settings-nav-item.active{background:var(--teal-lt);color:var(--teal);font-weight:600}
.settings-content{display:flex;flex-direction:column;gap:16px}
.settings-card{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:22px}
.settings-card-title{font-family:var(--ff-head);font-size:1.05rem;font-weight:500;color:var(--ink);margin-bottom:4px}
.settings-card-sub{font-size:.75rem;color:var(--ink3);margin-bottom:18px;line-height:1.5}
.settings-section{display:none}
.settings-section.active{display:block}
.form-group{margin-bottom:16px}
.form-label{font-size:.72rem;font-weight:600;color:var(--ink2);text-transform:uppercase;letter-spacing:.05em;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.form-input{width:100%;padding:9px 13px;border-radius:var(--r2);border:1.5px solid var(--border2);font-family:var(--ff-body);font-size:.85rem;color:var(--ink);background:#fff;transition:border-color .15s}
.form-input:focus{outline:none;border-color:var(--teal)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-select{width:100%;padding:9px 13px;border-radius:var(--r2);border:1.5px solid var(--border2);font-family:var(--ff-body);font-size:.85rem;color:var(--ink);background:#fff;cursor:pointer}
.form-select:focus{outline:none;border-color:var(--teal)}

/* Sensor status cards */
.sensor-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:18px}
.sensor-card{border-radius:var(--r2);border:1.5px solid var(--border);padding:14px;display:flex;align-items:flex-start;gap:10px;transition:all .2s;cursor:pointer}
.sensor-card:hover{border-color:var(--teal);box-shadow:var(--shadow)}
.sensor-card.connected{border-color:var(--teal);background:var(--teal-lt)}
.sensor-card.error{border-color:var(--red);background:var(--red-lt)}
.sensor-card.searching{border-color:var(--amber);background:var(--amber-lt)}
.sensor-icon{font-size:1.4rem;flex-shrink:0}
.sensor-name{font-size:.82rem;font-weight:600;color:var(--ink);margin-bottom:2px}
.sensor-desc{font-size:.7rem;color:var(--ink3)}
.sensor-status{font-size:.68rem;font-weight:700;margin-top:6px;display:inline-flex;align-items:center;gap:4px}
.sensor-status.ok{color:var(--teal)}
.sensor-status.err{color:var(--red)}
.sensor-status.search{color:var(--amber)}
.sensor-dot{width:6px;height:6px;border-radius:50%;display:inline-block}

/* Toggle switch */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)}
.toggle-row:last-child{border-bottom:none}
.toggle-label{font-size:.82rem;color:var(--ink2);font-weight:500}
.toggle-desc{font-size:.7rem;color:var(--ink3);margin-top:2px}
.toggle{position:relative;width:40px;height:22px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--cream3);border-radius:22px;transition:.3s}
.slider:before{content:'';position:absolute;height:16px;width:16px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:.3s;box-shadow:0 1px 3px rgba(0,0,0,.2)}
input:checked+.slider{background:var(--teal)}
input:checked+.slider:before{transform:translateX(18px)}

/* Range slider */
.range-row{display:flex;align-items:center;gap:12px}
.range-slider{-webkit-appearance:none;flex:1;height:5px;border-radius:3px;background:var(--cream2);outline:none}
.range-slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--teal);cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.range-val{font-size:.82rem;font-weight:600;color:var(--teal);width:50px;text-align:right}

/* Connection panel */
.conn-input-row{display:flex;gap:8px;align-items:flex-end}
.conn-status-bar{padding:10px 14px;border-radius:var(--r2);background:var(--cream);font-size:.78rem;color:var(--ink3);display:flex;align-items:center;gap:8px;margin-top:10px}
.protocol-tabs{display:flex;gap:4px;margin-bottom:16px}
.proto-tab{padding:6px 14px;border-radius:var(--r2);font-size:.76rem;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:#fff;color:var(--ink3);transition:all .15s}
.proto-tab.active{border-color:var(--teal);background:var(--teal-lt);color:var(--teal)}

/* ‚ïê‚ïê‚ïê PROFILE PAGE ‚ïê‚ïê‚ïê */
.profile-body{padding:22px 30px 40px;display:grid;grid-template-columns:300px 1fr;gap:20px;align-items:start}
.profile-card{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:26px;text-align:center}
.profile-avatar-lg{width:80px;height:80px;border-radius:50%;background:var(--teal);display:flex;align-items:center;justify-content:center;font-family:var(--ff-head);font-size:1.9rem;font-weight:700;color:#fff;margin:0 auto 14px;cursor:pointer;transition:opacity .2s}
.profile-avatar-lg:hover{opacity:.85}
.profile-name{font-family:var(--ff-head);font-size:1.45rem;font-weight:500;color:var(--ink);margin-bottom:3px}
.profile-id{font-size:.7rem;color:var(--ink3);margin-bottom:18px}
.profile-stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:14px}
.profile-stat{padding:9px;background:var(--cream);border-radius:var(--r2);text-align:left}
.profile-stat-val{font-family:var(--ff-head);font-size:1.05rem;font-weight:500;color:var(--ink);margin-bottom:1px}
.profile-stat-lbl{font-size:.62rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em}
.profile-right{display:flex;flex-direction:column;gap:14px}
.info-section{background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:20px 22px}
.info-section-title{font-family:var(--ff-head);font-size:.95rem;font-weight:500;color:var(--ink);margin-bottom:12px;padding-bottom:9px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.info-item{display:flex;flex-direction:column;gap:2px}
.info-label{font-size:.65rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em}
.info-value{font-size:.85rem;font-weight:500;color:var(--ink)}
.baseline-bars{display:flex;flex-direction:column;gap:9px}
.baseline-row{display:flex;align-items:center;gap:9px}
.baseline-sig-name{font-size:.72rem;color:var(--ink2);width:120px;flex-shrink:0;font-weight:500}
.baseline-track{flex:1;height:6px;background:var(--cream2);border-radius:3px;overflow:hidden}
.baseline-fill{height:100%;border-radius:3px}
.baseline-val{font-size:.7rem;font-weight:600;color:var(--ink2);width:70px;text-align:right;flex-shrink:0;font-family:var(--ff-head)}

/* Edit modal */
.modal-overlay{position:fixed;inset:0;background:rgba(26,20,16,.5);z-index:200;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:var(--r);box-shadow:var(--shadow-lg);padding:28px;width:560px;max-width:95vw;max-height:90vh;overflow-y:auto;animation:fadein .25s ease}
.modal-title{font-family:var(--ff-head);font-size:1.3rem;font-weight:500;color:var(--ink);margin-bottom:4px}
.modal-sub{font-size:.78rem;color:var(--ink3);margin-bottom:22px}
.modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:22px;padding-top:16px;border-top:1px solid var(--border)}

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
.toast{position:fixed;top:18px;right:18px;z-index:1000;background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow-lg);padding:13px 16px;max-width:310px;display:flex;gap:11px;align-items:flex-start;transform:translateX(360px);transition:transform .3s cubic-bezier(0.34,1.56,0.64,1)}
.toast.show{transform:translateX(0)}
.toast-icon{font-size:1.1rem;flex-shrink:0;margin-top:1px}
.toast-title{font-size:.8rem;font-weight:700;color:var(--ink);margin-bottom:2px}
.toast-msg{font-size:.72rem;color:var(--ink3);line-height:1.4}
.toast-close{margin-left:auto;flex-shrink:0;background:none;border:none;cursor:pointer;color:var(--ink3);font-size:.95rem;padding:0}

/* Misc */
.divider{height:1px;background:var(--border);margin:4px 0}
.empty-state{text-align:center;padding:38px;color:var(--ink3);font-size:.82rem}
.empty-state-icon{font-size:2.4rem;margin-bottom:11px;opacity:.5}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--cream3);border-radius:3px}
@keyframes fadein{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.fadein{animation:fadein .35s ease both}
@keyframes pulse-border{0%,100%{border-color:rgba(196,107,232,.3)}50%{border-color:rgba(196,107,232,.9)}}
.waveform-bar{display:inline-block;width:3px;border-radius:2px;background:#c46be8;margin:0 1px;transition:height .1s ease;transform-origin:bottom center}

@media(max-width:1200px){.signal-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:1000px){.signal-grid{grid-template-columns:repeat(2,1fr)}.monitor-body{grid-template-columns:1fr 270px}}
@media(max-width:820px){.nav{width:60px}.nav-brand-name,.nav-brand-sub,.nav-patient,.nav-link span:not(.icon),.live-chip span,.mic-chip span,.nav-section-label{display:none}.nav-link{justify-content:center;padding:11px}.monitor-body{grid-template-columns:1fr;padding:16px}.monitor-right{display:none}.signal-grid{grid-template-columns:repeat(2,1fr)}.page-header{padding:18px 16px 0}.settings-body,.profile-body{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app-shell">

<!-- ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê -->
<nav class="nav">
  <div class="nav-brand">
    <div class="nav-brand-name">PulseIQ <span style="font-size:.7rem;color:var(--teal2);font-family:var(--ff-body);font-weight:600">PRO</span></div>
    <div class="nav-brand-sub">Health Intelligence</div>
  </div>
  <div class="nav-patient" onclick="openEditModal()">
    <div class="nav-avatar" id="nav-avatar">AK</div>
    <div>
      <div class="nav-patient-name" id="nav-name">Alex Kumar</div>
      <div class="nav-patient-id" id="nav-pid">PHM-2841 ¬∑ Edit ‚úèÔ∏è</div>
    </div>
  </div>
  <div class="nav-links">
    <div class="nav-section-label">Monitoring</div>
    <button class="nav-link active" onclick="showPage('monitor',this)"><span class="icon">üíì</span><span>Live Monitor</span></button>
    <button class="nav-link" onclick="showPage('alerts',this)"><span class="icon">üîî</span><span>Alerts</span><span class="nav-badge" id="alert-nav-badge">0</span></button>
    <button class="nav-link" onclick="showPage('history',this)"><span class="icon">üìà</span><span>History</span></button>
    <div class="nav-section-label">Tools</div>
    <button class="nav-link" onclick="showPage('mic',this)"><span class="icon">üéôÔ∏è</span><span>Behaviour AI</span></button>
    <button class="nav-link" onclick="showPage('wellness',this)"><span class="icon">üèÉ</span><span>Wellness</span></button>
    <div class="nav-section-label">Account</div>
    <button class="nav-link" onclick="showPage('profile',this)"><span class="icon">üë§</span><span>My Profile</span></button>
    <button class="nav-link" onclick="showPage('settings',this)"><span class="icon">‚öôÔ∏è</span><span>Settings</span></button>
  </div>
  <div class="nav-footer">
    <div class="live-chip" id="sensor-chip"><div class="live-dot"></div><span id="sensor-chip-text">Sensors active</span></div>
    <div class="mic-chip" id="nav-mic-btn" onclick="toggleMicFromNav()"><div class="mic-dot" id="nav-mic-dot" style="animation:none"></div><span id="nav-mic-text">Mic off</span></div>
  </div>
</nav>

<div class="main-content">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: LIVE MONITOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-monitor">
  <div class="page-header">
    <div>
      <div class="page-title">Live Monitor</div>
      <div class="page-subtitle" id="monitor-time">Updating now ‚Äî 10 Hz sampling</div>
    </div>
    <div class="page-actions">
      <button class="btn btn-ghost btn-sm" onclick="togglePause()" id="pause-btn">‚è∏ Pause</button>
      <button class="btn btn-primary btn-sm" onclick="resetAll()">‚Ü∫ Reset</button>
    </div>
  </div>

  <div class="monitor-body">
    <!-- HRI Hero -->
    <div class="hri-hero fadein">
      <div class="hri-gauge-box">
        <canvas id="hri-canvas" width="160" height="160" style="display:block"></canvas>
        <div class="hri-score-num" id="hri-num">0</div>
        <div class="hri-score-label">HRI SCORE</div>
      </div>
      <div class="hri-hero-info">
        <div class="hri-status-badge" id="hri-badge">‚óè Normal</div>
        <div class="hri-hero-title" id="hri-title">All signals within your personal baseline</div>
        <div class="hri-hero-desc" id="hri-desc">Your multi-signal correlation patterns are stable.</div>
        <div class="hri-meta">
          <div class="hri-meta-item"><span class="hri-meta-val" id="meta-maha">0.0</span><span class="hri-meta-lbl">Deviation Score</span></div>
          <div class="hri-meta-item"><span class="hri-meta-val" id="meta-lstm">0.0</span><span class="hri-meta-lbl">Pattern Score</span></div>
          <div class="hri-meta-item"><span class="hri-meta-val" id="meta-samples">0</span><span class="hri-meta-lbl">Samples</span></div>
          <div class="hri-meta-item"><span class="hri-meta-val" id="meta-uptime">0s</span><span class="hri-meta-lbl">Session</span></div>
          <div class="hri-meta-item"><span class="hri-meta-val" id="meta-steps" style="color:var(--teal)">0</span><span class="hri-meta-lbl">Steps Today</span></div>
          <div class="hri-meta-item"><span class="hri-meta-val" id="meta-fever" style="color:var(--amber)">36.8¬∞</span><span class="hri-meta-lbl">Body Temp</span></div>
        </div>
      </div>
    </div>

    <!-- Signal Cards -->
    <div class="signal-grid" id="signal-grid"></div>

    <!-- Right column -->
    <div class="monitor-right">
      <div class="alert-banner" id="active-alert-banner">
        <div class="alert-banner-top">
          <span class="alert-banner-icon" id="ab-icon">‚ö†Ô∏è</span>
          <span class="alert-banner-level" id="ab-level">Elevated</span>
          <span class="alert-banner-time" id="ab-time"></span>
        </div>
        <div class="alert-banner-msg" id="ab-msg">Alert message here</div>
        <div class="alert-banner-signals" id="ab-signals"></div>
      </div>
      <!-- Correlation -->
      <div class="widget">
        <div class="widget-title">Signal Correlations <span style="font-size:.58rem;font-weight:400;color:var(--ink3)">Pearson r</span></div>
        <div class="corr-heatmap" id="corr-heatmap"></div>
        <div class="corr-col-labels" id="corr-col-labels" style="display:grid;gap:3px;margin-top:3px"></div>
      </div>
      <!-- Scenarios -->
      <div class="widget">
        <div class="widget-title">Demo Scenarios</div>
        <div class="scenario-btns">
          <button class="scenario-btn full active" onclick="setScenario('normal',this)">‚úì Normal</button>
          <button class="scenario-btn" onclick="setScenario('cardiac',this)">‚ù§Ô∏è Cardiac</button>
          <button class="scenario-btn" onclick="setScenario('hypoxia',this)">ü´Å Hypoxia</button>
          <button class="scenario-btn" onclick="setScenario('infection',this)">ü¶† Infection</button>
          <button class="scenario-btn" onclick="setScenario('fever',this)">üå°Ô∏è High Fever</button>
          <button class="scenario-btn" onclick="setScenario('overexertion',this)">‚ö° Overexertion</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: ALERTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-alerts">
  <div class="page-header">
    <div><div class="page-title">Alerts</div><div class="page-subtitle">Your health event log and notifications</div></div>
    <div class="page-actions"><button class="btn btn-ghost btn-sm" onclick="clearAlerts()">Clear All</button></div>
  </div>
  <div class="alerts-body fadein">
    <div class="alert-stats-row">
      <div class="stat-card"><div class="stat-card-val" id="astat-total">0</div><div class="stat-card-lbl">Total Alerts</div></div>
      <div class="stat-card"><div class="stat-card-val" id="astat-critical" style="color:var(--red)">0</div><div class="stat-card-lbl">Critical / Emergency</div></div>
      <div class="stat-card"><div class="stat-card-val" id="astat-high" style="color:var(--amber)">0</div><div class="stat-card-lbl">High Risk</div></div>
      <div class="stat-card"><div class="stat-card-val" id="astat-resolved" style="color:var(--green)">0</div><div class="stat-card-lbl">Resolved</div></div>
    </div>
    <div class="alert-filter-row">
      <span style="font-size:.73rem;color:var(--ink3);font-weight:600">Filter:</span>
      <button class="filter-chip active" onclick="filterAlerts('all',this)">All</button>
      <button class="filter-chip" onclick="filterAlerts('emergency',this)">Emergency</button>
      <button class="filter-chip" onclick="filterAlerts('critical',this)">Critical</button>
      <button class="filter-chip" onclick="filterAlerts('high',this)">High</button>
      <button class="filter-chip" onclick="filterAlerts('elevated',this)">Elevated</button>
      <button class="filter-chip" onclick="filterAlerts('fever',this)">üå°Ô∏è Fever</button>
      <button class="filter-chip" onclick="filterAlerts('behaviour',this)">üéôÔ∏è Behaviour</button>
    </div>
    <div class="alert-list" id="alert-list">
      <div class="empty-state"><div class="empty-state-icon">üîî</div>No alerts yet.</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-history">
  <div class="page-header">
    <div><div class="page-title">History & Analytics</div><div class="page-subtitle">Your health patterns over time</div></div>
    <div class="page-actions">
      <div class="history-tabs">
        <button class="history-tab active" onclick="setHistoryTab('7d',this)">7 Days</button>
        <button class="history-tab" onclick="setHistoryTab('30d',this)">30 Days</button>
        <button class="history-tab" onclick="setHistoryTab('90d',this)">3 Months</button>
      </div>
    </div>
  </div>
  <div class="history-body fadein">
    <div class="history-grid">
      <div class="history-card history-card-full">
        <div class="history-card-title">Health Risk Index ‚Äî Trend</div>
        <div class="history-card-sub">Daily average HRI with risk band overlay</div>
        <canvas class="history-chart" id="hri-trend-chart" height="120"></canvas>
        <div class="trend-indicators">
          <div class="trend-item"><div class="trend-val" id="tr-avg" style="color:var(--teal)">‚Äî</div><div class="trend-lbl">Avg HRI</div></div>
          <div class="trend-item"><div class="trend-val" id="tr-peak" style="color:var(--red)">‚Äî</div><div class="trend-lbl">Peak HRI</div></div>
          <div class="trend-item"><div class="trend-val" id="tr-events" style="color:var(--amber)">‚Äî</div><div class="trend-lbl">Alert Events</div></div>
        </div>
      </div>
      <div class="history-card">
        <div class="history-card-title">Signal Averages</div>
        <div class="history-card-sub">7-day mean vs. your personal baseline</div>
        <canvas class="history-chart" id="sig-avg-chart" height="160"></canvas>
      </div>
      <div class="history-card">
        <div class="history-card-title">Fever & Temperature</div>
        <div class="history-card-sub">Body temperature trend with fever threshold</div>
        <canvas class="history-chart" id="temp-trend-chart" height="160"></canvas>
      </div>
      <div class="history-card">
        <div class="history-card-title">Daily Steps</div>
        <div class="history-card-sub">Step count vs. goal (10,000 steps)</div>
        <canvas class="history-chart" id="steps-chart" height="160"></canvas>
      </div>
      <div class="history-card">
        <div class="history-card-title">AI Pattern Insights</div>
        <div class="history-card-sub">Detected correlation patterns this week</div>
        <div class="pattern-grid" id="pattern-grid"></div>
      </div>
      <div class="history-card history-card-full">
        <div class="history-card-title">Daily Summary</div>
        <div class="history-card-sub">HRI score and events per day</div>
        <div class="daily-summary" id="daily-summary"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: BEHAVIOUR AI (MIC) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-mic">
  <div class="page-header">
    <div>
      <div class="page-title">Behaviour AI</div>
      <div class="page-subtitle">Real-time microphone analysis for health behaviour detection</div>
    </div>
    <div class="page-actions">
      <button class="btn btn-purple btn-sm" id="mic-main-btn" onclick="toggleMic()">üéôÔ∏è Start Listening</button>
    </div>
  </div>
  <div style="padding:22px 30px 40px;display:grid;grid-template-columns:1fr 1fr;gap:20px">
    <!-- Live analysis panel -->
    <div style="display:flex;flex-direction:column;gap:16px">
      <div class="settings-card">
        <div class="settings-card-title">Live Audio Analysis</div>
        <div class="settings-card-sub">AI listens for behavioural patterns including smoking, coughing, drinking, and stress indicators</div>
        <div style="background:#1A1028;border-radius:var(--r2);padding:16px;margin-bottom:14px">
          <div style="font-size:.68rem;color:#c46be8;font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px;display:flex;align-items:center;gap:6px">
            <div class="live-dot" id="mic-vis-dot" style="background:#c46be8;box-shadow:0 0 6px #c46be8;animation:none"></div>
            Audio Waveform
          </div>
          <canvas id="mic-waveform" style="width:100%;height:60px;display:block;border-radius:6px"></canvas>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px" id="behaviour-detections">
          <!-- Populated by JS -->
        </div>
        <div style="margin-top:14px;padding:12px;background:var(--cream);border-radius:var(--r2)">
          <div style="font-size:.7rem;color:var(--ink3);font-weight:600;margin-bottom:6px">ü§ñ AI Interpretation</div>
          <div style="font-size:.82rem;color:var(--ink2);line-height:1.6" id="mic-ai-text">Start listening to receive real-time behavioural analysis.</div>
        </div>
      </div>
      <!-- Session stats -->
      <div class="settings-card">
        <div class="settings-card-title">Session Statistics</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:4px">
          <div style="text-align:center;padding:12px;background:var(--cream);border-radius:var(--r2)">
            <div style="font-family:var(--ff-head);font-size:1.5rem;font-weight:500;color:var(--purple)" id="mic-detections-count">0</div>
            <div style="font-size:.64rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em">Detections</div>
          </div>
          <div style="text-align:center;padding:12px;background:var(--cream);border-radius:var(--r2)">
            <div style="font-family:var(--ff-head);font-size:1.5rem;font-weight:500;color:var(--red)" id="mic-cough-count">0</div>
            <div style="font-size:.64rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em">Coughs</div>
          </div>
          <div style="text-align:center;padding:12px;background:var(--cream);border-radius:var(--r2)">
            <div style="font-family:var(--ff-head);font-size:1.5rem;font-weight:500;color:var(--amber)" id="mic-session-time">0m</div>
            <div style="font-size:.64rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em">Session</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Detection log -->
    <div class="settings-card">
      <div class="settings-card-title">Detection Log</div>
      <div class="settings-card-sub">All detected behavioural events with timestamps</div>
      <div style="display:flex;flex-direction:column;gap:7px;max-height:480px;overflow-y:auto" id="mic-log">
        <div class="empty-state" style="padding:24px"><div class="empty-state-icon">üéôÔ∏è</div>No events detected yet.</div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: WELLNESS / STEPS / FEVER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-wellness">
  <div class="page-header">
    <div><div class="page-title">Wellness</div><div class="page-subtitle">Activity, fever monitoring, and health goals</div></div>
    <div class="page-actions">
      <button class="btn btn-ghost btn-sm" onclick="addSteps()">+ Add Steps</button>
    </div>
  </div>
  <div style="padding:22px 30px 40px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px">
    <!-- Step counter card -->
    <div class="settings-card" style="grid-column:1/-1">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:16px;align-items:center">
        <div>
          <div style="font-size:.7rem;font-weight:600;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px">Today's Steps</div>
          <div class="steps-val" id="wellness-steps">0</div>
          <div class="steps-goal" id="wellness-steps-goal">Goal: 10,000 ¬∑ 0%</div>
          <div class="steps-badges" id="steps-badges"></div>
        </div>
        <div style="grid-column:2/4">
          <div style="font-size:.68rem;color:var(--ink3);font-weight:600;margin-bottom:6px">Progress</div>
          <div style="height:14px;background:var(--cream2);border-radius:7px;overflow:hidden;margin-bottom:6px">
            <div id="steps-progress-bar" style="height:100%;border-radius:7px;background:linear-gradient(90deg,var(--teal),var(--teal2));transition:width .5s ease;width:0%"></div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">
            <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
              <div style="font-family:var(--ff-head);font-size:1rem;color:var(--teal)" id="ws-calories">0</div>
              <div style="font-size:.62rem;color:var(--ink3)">Calories</div>
            </div>
            <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
              <div style="font-family:var(--ff-head);font-size:1rem;color:var(--blue)" id="ws-distance">0.0</div>
              <div style="font-size:.62rem;color:var(--ink3)">km</div>
            </div>
            <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
              <div style="font-family:var(--ff-head);font-size:1rem;color:var(--amber)" id="ws-active">0</div>
              <div style="font-size:.62rem;color:var(--ink3)">Active min</div>
            </div>
            <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
              <div style="font-family:var(--ff-head);font-size:1rem;color:var(--purple)" id="ws-floors">0</div>
              <div style="font-size:.62rem;color:var(--ink3)">Floors</div>
            </div>
          </div>
        </div>
        <div style="text-align:center">
          <canvas id="steps-donut" width="120" height="120" style="display:block;margin:0 auto"></canvas>
        </div>
      </div>
    </div>

    <!-- Fever / Body temp card -->
    <div class="settings-card" style="grid-column:1/3">
      <div class="settings-card-title">üå°Ô∏è Fever Monitor</div>
      <div class="settings-card-sub">Real-time body temperature with clinical zone classification</div>
      <div style="display:flex;align-items:center;gap:20px;margin-bottom:16px">
        <div>
          <div style="font-family:var(--ff-head);font-size:3.5rem;font-weight:500;line-height:1" id="fever-big-val">36.8</div>
          <div style="font-size:.85rem;color:var(--ink3)">¬∞C body temperature</div>
          <div class="fever-status" id="fever-status-badge" style="background:var(--green-lt);color:var(--green)">‚úì Normal</div>
        </div>
        <div style="flex:1">
          <div style="font-size:.68rem;font-weight:600;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px">Temperature Zone</div>
          <div class="fever-zones">
            <div class="fever-zone" style="background:#1A7B4A;flex:1" title="Hypothermic <36¬∞C"></div>
            <div class="fever-zone" style="background:#0A7B6C;flex:1.5" title="Sub-normal 36-36.5¬∞C"></div>
            <div class="fever-zone" style="background:#2196F3;flex:2" title="Normal 36.5-37.5¬∞C"></div>
            <div class="fever-zone" style="background:#C97B1A;flex:1.5" title="Low-grade 37.5-38¬∞C"></div>
            <div class="fever-zone" style="background:#E67E22;flex:1.5" title="Fever 38-39¬∞C"></div>
            <div class="fever-zone" style="background:#C0392B;flex:1" title="High Fever 39-40¬∞C"></div>
            <div class="fever-zone" style="background:#8B0000;flex:0.5" title="Hyperpyrexia >40¬∞C"></div>
          </div>
          <div class="fever-labels">
            <span>&lt;36</span><span>36.5</span><span>37</span><span>37.5</span><span>38</span><span>39</span><span>40+</span>
          </div>
          <!-- Arrow indicator -->
          <div style="position:relative;height:14px;margin-top:2px">
            <div id="fever-arrow" style="position:absolute;top:0;font-size:.8rem;transition:left .5s ease">üî∫</div>
          </div>
        </div>
      </div>
      <!-- Temp history mini chart -->
      <canvas id="fever-mini-chart" style="width:100%;height:60px;display:block" height="60"></canvas>
      <!-- Stats row -->
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:14px">
        <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
          <div style="font-family:var(--ff-head);font-size:1rem;color:var(--blue)" id="temp-min">36.6</div>
          <div style="font-size:.62rem;color:var(--ink3)">Today Min</div>
        </div>
        <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
          <div style="font-family:var(--ff-head);font-size:1rem;color:var(--red)" id="temp-max">36.9</div>
          <div style="font-size:.62rem;color:var(--ink3)">Today Max</div>
        </div>
        <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
          <div style="font-family:var(--ff-head);font-size:1rem;color:var(--ink)" id="temp-avg">36.8</div>
          <div style="font-size:.62rem;color:var(--ink3)">Average</div>
        </div>
        <div style="text-align:center;padding:8px;background:var(--cream);border-radius:8px">
          <div style="font-family:var(--ff-head);font-size:1rem;color:var(--amber)" id="temp-trend-val">Stable</div>
          <div style="font-size:.62rem;color:var(--ink3)">Trend</div>
        </div>
      </div>
    </div>

    <!-- Goals card -->
    <div class="settings-card">
      <div class="settings-card-title">Daily Goals</div>
      <div style="display:flex;flex-direction:column;gap:12px;margin-top:8px">
        <div>
          <div style="display:flex;justify-content:space-between;font-size:.78rem;margin-bottom:5px"><span style="font-weight:600">üë£ Steps</span><span id="g-steps">0 / 10,000</span></div>
          <div style="height:8px;background:var(--cream2);border-radius:4px;overflow:hidden"><div id="gbar-steps" style="height:100%;background:var(--teal);border-radius:4px;transition:width .5s;width:0%"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;font-size:.78rem;margin-bottom:5px"><span style="font-weight:600">üíß Water (glasses)</span><span id="g-water">0 / 8</span></div>
          <div style="height:8px;background:var(--cream2);border-radius:4px;overflow:hidden"><div id="gbar-water" style="height:100%;background:var(--blue);border-radius:4px;transition:width .5s;width:0%"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;font-size:.78rem;margin-bottom:5px"><span style="font-weight:600">üî• Calories</span><span id="g-calories">0 / 2200</span></div>
          <div style="height:8px;background:var(--cream2);border-radius:4px;overflow:hidden"><div id="gbar-calories" style="height:100%;background:var(--orange);border-radius:4px;transition:width .5s;width:0%"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;font-size:.78rem;margin-bottom:5px"><span style="font-weight:600">üò¥ Sleep (hrs)</span><span id="g-sleep">7.5 / 8</span></div>
          <div style="height:8px;background:var(--cream2);border-radius:4px;overflow:hidden"><div id="gbar-sleep" style="height:100%;background:var(--purple);border-radius:4px;transition:width .5s;width:93.75%"></div></div>
        </div>
        <div style="border-top:1px solid var(--border);padding-top:12px;display:flex;flex-direction:column;gap:6px">
          <button class="btn btn-primary btn-sm" style="width:100%;justify-content:center" onclick="addWater()">üíß + Glass of Water</button>
          <button class="btn btn-ghost btn-sm" style="width:100%;justify-content:center" onclick="addSteps()">üë£ + Log Steps</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-profile">
  <div class="page-header">
    <div><div class="page-title">My Profile</div><div class="page-subtitle">Personal details and physiological baseline</div></div>
    <div class="page-actions"><button class="btn btn-primary btn-sm" onclick="openEditModal()">‚úèÔ∏è Edit Profile</button></div>
  </div>
  <div class="profile-body fadein">
    <div class="profile-card">
      <div class="profile-avatar-lg" id="profile-avatar-lg" onclick="openEditModal()">AK</div>
      <div class="profile-name" id="profile-name">Alex Kumar</div>
      <div class="profile-id" id="profile-id">Patient ID: PHM-2841 ¬∑ Joined Jan 2024</div>
      <div class="divider"></div>
      <div style="text-align:left;display:flex;flex-direction:column;gap:7px;margin-top:8px">
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">Age</span><span style="font-weight:600" id="p-age">34 years</span></div>
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">Gender</span><span style="font-weight:600" id="p-gender">Male</span></div>
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">Height</span><span style="font-weight:600" id="p-height">175 cm</span></div>
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">Weight</span><span style="font-weight:600" id="p-weight">72 kg</span></div>
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">BMI</span><span style="font-weight:600" id="p-bmi">23.5</span></div>
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">Blood Type</span><span style="font-weight:600" id="p-blood">A+</span></div>
        <div style="display:flex;justify-content:space-between;font-size:.8rem"><span style="color:var(--ink3)">Device</span><span style="font-weight:600">ESP32 v2.1</span></div>
      </div>
      <div class="profile-stats-grid">
        <div class="profile-stat"><div class="profile-stat-val" id="ps-days">14</div><div class="profile-stat-lbl">Days Active</div></div>
        <div class="profile-stat"><div class="profile-stat-val" id="ps-alerts">0</div><div class="profile-stat-lbl">Alerts Total</div></div>
        <div class="profile-stat"><div class="profile-stat-val" style="color:var(--teal)">98.5%</div><div class="profile-stat-lbl">Baseline Fit</div></div>
        <div class="profile-stat"><div class="profile-stat-val" style="color:var(--green)">Good</div><div class="profile-stat-lbl">Status</div></div>
      </div>
    </div>
    <div class="profile-right">
      <div class="info-section">
        <div class="info-section-title">Medical Information <button class="btn btn-ghost btn-sm" onclick="openEditModal('medical')">Edit</button></div>
        <div class="info-grid">
          <div class="info-item"><span class="info-label">Conditions</span><span class="info-value" id="p-conditions">None listed</span></div>
          <div class="info-item"><span class="info-label">Medications</span><span class="info-value" id="p-medications">None listed</span></div>
          <div class="info-item"><span class="info-label">Allergies</span><span class="info-value" id="p-allergies">Penicillin</span></div>
          <div class="info-item"><span class="info-label">Emergency Contact</span><span class="info-value" id="p-emergency">+91 98765 43210</span></div>
          <div class="info-item"><span class="info-label">Physician</span><span class="info-value" id="p-physician">Dr. R. Sharma</span></div>
          <div class="info-item"><span class="info-label">Last Check-up</span><span class="info-value" id="p-checkup">Nov 2024</span></div>
        </div>
      </div>
      <div class="info-section">
        <div class="info-section-title">Personal Physiological Baseline</div>
        <p style="font-size:.75rem;color:var(--ink3);margin-bottom:12px;line-height:1.5">Learned from your first 14 days of monitoring. Used to calculate your personalized HRI.</p>
        <div class="baseline-bars" id="baseline-bars"></div>
      </div>
      <div class="info-section">
        <div class="info-section-title">Wearable Device</div>
        <div class="info-grid">
          <div class="info-item"><span class="info-label">Hardware</span><span class="info-value">ESP32 WROOM-32</span></div>
          <div class="info-item"><span class="info-label">Firmware</span><span class="info-value">v2.1.4</span></div>
          <div class="info-item"><span class="info-label">Sample Rate</span><span class="info-value">10 Hz</span></div>
          <div class="info-item"><span class="info-label">Battery</span><span class="info-value" id="p-battery">87% (Est. 9hr)</span></div>
          <div class="info-item"><span class="info-label">Sensors</span><span class="info-value">MAX30105, AD8232, DS18B20, GSR, MPU6050</span></div>
          <div class="info-item"><span class="info-label">Protocol</span><span class="info-value" id="p-protocol">BLE 5.0 + MQTT</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: SETTINGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-settings">
  <div class="page-header">
    <div><div class="page-title">Settings</div><div class="page-subtitle">Sensor connections, alerts, thresholds, and preferences</div></div>
  </div>
  <div class="settings-body fadein">
    <!-- Settings nav -->
    <div>
      <div style="background:#fff;border-radius:var(--r);border:1px solid var(--border);box-shadow:var(--shadow);padding:8px">
        <div class="settings-nav">
          <button class="settings-nav-item active" onclick="showSettingsSection('sensors',this)">üì° Sensor Connections</button>
          <button class="settings-nav-item" onclick="showSettingsSection('thresholds',this)">üìä Alert Thresholds</button>
          <button class="settings-nav-item" onclick="showSettingsSection('notifications',this)">üîî Notifications</button>
          <button class="settings-nav-item" onclick="showSettingsSection('display',this)">üé® Display & UI</button>
          <button class="settings-nav-item" onclick="showSettingsSection('data',this)">üíæ Data & Privacy</button>
          <button class="settings-nav-item" onclick="showSettingsSection('about',this)">‚ÑπÔ∏è About</button>
        </div>
      </div>
    </div>
    <!-- Settings content -->
    <div class="settings-content">

      <!-- SENSORS -->
      <div class="settings-section active" id="ss-sensors">
        <div class="settings-card">
          <div class="settings-card-title">Sensor Connections</div>
          <div class="settings-card-sub">Manage and configure your wearable sensors. Click a sensor card to toggle its connection state.</div>
          <div class="sensor-grid" id="sensor-grid"></div>
          <div style="font-size:.78rem;font-weight:600;color:var(--ink2);margin-bottom:10px">Connection Protocol</div>
          <div class="protocol-tabs">
            <button class="proto-tab active" id="proto-ble" onclick="setProto('ble',this)">üì∂ BLE 5.0</button>
            <button class="proto-tab" id="proto-wifi" onclick="setProto('wifi',this)">üì° Wi-Fi MQTT</button>
            <button class="proto-tab" id="proto-usb" onclick="setProto('usb',this)">üîå USB Serial</button>
            <button class="proto-tab" id="proto-demo" onclick="setProto('demo',this)">üß™ Demo Mode</button>
          </div>
          <div style="margin-top:12px">
            <div class="form-group">
              <div class="form-label">Device Address / Host</div>
              <div class="conn-input-row">
                <input class="form-input" id="conn-addr" placeholder="e.g. ESP32-PulseIQ or 192.168.1.100" style="flex:1">
                <button class="btn btn-primary btn-sm" onclick="simulateConnect()">Connect</button>
              </div>
            </div>
            <div class="conn-status-bar" id="conn-status">
              <div class="live-dot"></div>
              <span>Demo mode active ‚Äî simulated sensor data streaming at 10 Hz</span>
            </div>
          </div>
        </div>
      </div>

      <!-- THRESHOLDS -->
      <div class="settings-section" id="ss-thresholds">
        <div class="settings-card">
          <div class="settings-card-title">Alert Thresholds</div>
          <div class="settings-card-sub">Customize alert trigger values for each vital sign. Changes take effect immediately.</div>
          <div id="threshold-settings"></div>
        </div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="settings-section" id="ss-notifications">
        <div class="settings-card">
          <div class="settings-card-title">Notification Settings</div>
          <div class="settings-card-sub">Control how and when PulseIQ notifies you about health events.</div>
          <div>
            <div class="toggle-row">
              <div><div class="toggle-label">Alert Sounds</div><div class="toggle-desc">Play audio for critical alerts</div></div>
              <label class="toggle"><input type="checkbox" checked id="notif-sound"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Browser Notifications</div><div class="toggle-desc">Show system notifications for high-risk events</div></div>
              <label class="toggle"><input type="checkbox" id="notif-browser"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Fever Alerts</div><div class="toggle-desc">Notify when temperature exceeds 37.8¬∞C</div></div>
              <label class="toggle"><input type="checkbox" checked id="notif-fever"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Behaviour Detection Alerts</div><div class="toggle-desc">Alert when smoking or coughing is detected</div></div>
              <label class="toggle"><input type="checkbox" checked id="notif-behaviour"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Step Goal Reminder</div><div class="toggle-desc">Remind when 75% of daily goal not reached by 7pm</div></div>
              <label class="toggle"><input type="checkbox" checked id="notif-steps"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Daily Health Summary</div><div class="toggle-desc">Receive daily summary at 9pm</div></div>
              <label class="toggle"><input type="checkbox" id="notif-summary"><span class="slider"></span></label>
            </div>
          </div>
          <div class="form-group" style="margin-top:18px">
            <div class="form-label">Alert Cooldown (minutes) <span id="cooldown-val" style="color:var(--teal)">4 min</span></div>
            <div class="range-row">
              <input type="range" class="range-slider" min="1" max="30" value="4" id="cooldown-slider" oninput="document.getElementById('cooldown-val').textContent=this.value+' min'">
            </div>
          </div>
        </div>
      </div>

      <!-- DISPLAY -->
      <div class="settings-section" id="ss-display">
        <div class="settings-card">
          <div class="settings-card-title">Display & UI</div>
          <div class="settings-card-sub">Customize the appearance and layout of your dashboard.</div>
          <div>
            <div class="toggle-row">
              <div><div class="toggle-label">Mini Waveforms</div><div class="toggle-desc">Show sparkline charts on signal cards</div></div>
              <label class="toggle"><input type="checkbox" checked id="disp-mini"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Correlation Heatmap</div><div class="toggle-desc">Show real-time correlation matrix</div></div>
              <label class="toggle"><input type="checkbox" checked id="disp-corr"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Animated HRI Gauge</div><div class="toggle-desc">Animate the health risk gauge needle</div></div>
              <label class="toggle"><input type="checkbox" checked id="disp-gauge"><span class="slider"></span></label>
            </div>
          </div>
          <div class="form-group" style="margin-top:18px">
            <div class="form-label">Temperature Unit</div>
            <select class="form-select" id="temp-unit" onchange="updateTempUnit()">
              <option value="C">Celsius (¬∞C)</option>
              <option value="F">Fahrenheit (¬∞F)</option>
            </select>
          </div>
          <div class="form-group">
            <div class="form-label">Step Goal <span id="step-goal-val" style="color:var(--teal)">10,000</span></div>
            <div class="range-row">
              <input type="range" class="range-slider" min="2000" max="20000" step="500" value="10000" id="step-goal-slider" oninput="updateStepGoal(this.value)">
            </div>
          </div>
        </div>
      </div>

      <!-- DATA -->
      <div class="settings-section" id="ss-data">
        <div class="settings-card">
          <div class="settings-card-title">Data & Privacy</div>
          <div class="settings-card-sub">Your health data stays on this device. No data is transmitted to external servers without your consent.</div>
          <div>
            <div class="toggle-row">
              <div><div class="toggle-label">Local Data Storage</div><div class="toggle-desc">Save session data in browser storage</div></div>
              <label class="toggle"><input type="checkbox" id="data-local"><span class="slider"></span></label>
            </div>
            <div class="toggle-row">
              <div><div class="toggle-label">Anonymous Analytics</div><div class="toggle-desc">Help improve PulseIQ with anonymous usage data</div></div>
              <label class="toggle"><input type="checkbox" id="data-anon"><span class="slider"></span></label>
            </div>
          </div>
          <div style="margin-top:18px;display:flex;gap:8px">
            <button class="btn btn-ghost btn-sm" onclick="exportData()">üì• Export Data (JSON)</button>
            <button class="btn btn-danger btn-sm" onclick="if(confirm('Clear all session data?')){resetAll();showToast('Data Cleared','Session data has been reset','normal')}">üóëÔ∏è Clear Session Data</button>
          </div>
        </div>
      </div>

      <!-- ABOUT -->
      <div class="settings-section" id="ss-about">
        <div class="settings-card">
          <div class="settings-card-title">About PulseIQ Pro</div>
          <div style="display:flex;flex-direction:column;gap:10px;margin-top:4px">
            <div class="info-item"><span class="info-label">Version</span><span class="info-value">2.0.0 Pro</span></div>
            <div class="info-item"><span class="info-label">Build</span><span class="info-value">2025-06-14</span></div>
            <div class="info-item"><span class="info-label">HRI Engine</span><span class="info-value">Mahalanobis + LSTM v3 + XGBoost</span></div>
            <div class="info-item"><span class="info-label">Signals</span><span class="info-value">9 vital signs incl. Fever + Steps</span></div>
            <div class="info-item"><span class="info-label">Behaviour AI</span><span class="info-value">Web Audio API + Pattern Classifier</span></div>
            <div class="info-item"><span class="info-label">Supported Sensors</span><span class="info-value">MAX30105, AD8232, DS18B20, GSR, MPU6050, NTC Thermistor</span></div>
          </div>
          <div style="margin-top:18px;padding:14px;background:var(--teal-lt);border-radius:var(--r2);font-size:.78rem;color:var(--teal);line-height:1.6">
            ‚öïÔ∏è <strong>Medical Disclaimer:</strong> PulseIQ Pro is a wellness monitoring tool and is not a medical device. It is not intended to diagnose, treat, cure, or prevent any medical condition. Always consult a qualified healthcare professional for medical advice.
          </div>
        </div>
      </div>

    </div><!-- /settings-content -->
  </div>
</div>

</div><!-- /main-content -->
</div><!-- /app-shell -->

<!-- ‚ïê‚ïê‚ïê EDIT PROFILE MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="edit-modal">
  <div class="modal">
    <div class="modal-title">Edit Profile</div>
    <div class="modal-sub">Update your personal details. Changes are reflected immediately across the app.</div>
    <div class="form-row">
      <div class="form-group"><div class="form-label">First Name</div><input class="form-input" id="edit-first" value="Alex"></div>
      <div class="form-group"><div class="form-label">Last Name</div><input class="form-input" id="edit-last" value="Kumar"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><div class="form-label">Age</div><input class="form-input" id="edit-age" type="number" value="34" min="1" max="120"></div>
      <div class="form-group"><div class="form-label">Gender</div>
        <select class="form-select" id="edit-gender"><option>Male</option><option>Female</option><option>Other</option></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><div class="form-label">Height (cm)</div><input class="form-input" id="edit-height" type="number" value="175"></div>
      <div class="form-group"><div class="form-label">Weight (kg)</div><input class="form-input" id="edit-weight" type="number" value="72"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><div class="form-label">Blood Type</div>
        <select class="form-select" id="edit-blood">
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
      </div>
      <div class="form-group"><div class="form-label">Patient ID</div><input class="form-input" id="edit-pid" value="PHM-2841"></div>
    </div>
    <div style="font-size:.78rem;font-weight:600;color:var(--ink2);margin:6px 0 12px;padding-top:12px;border-top:1px solid var(--border)">Medical Details</div>
    <div class="form-group"><div class="form-label">Conditions</div><input class="form-input" id="edit-conditions" value="None listed" placeholder="e.g. Hypertension, Diabetes"></div>
    <div class="form-group"><div class="form-label">Medications</div><input class="form-input" id="edit-medications" value="None listed"></div>
    <div class="form-group"><div class="form-label">Allergies</div><input class="form-input" id="edit-allergies" value="Penicillin"></div>
    <div class="form-row">
      <div class="form-group"><div class="form-label">Emergency Contact</div><input class="form-input" id="edit-emergency" value="+91 98765 43210"></div>
      <div class="form-group"><div class="form-label">Physician</div><input class="form-input" id="edit-physician" value="Dr. R. Sharma"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeEditModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveProfile()">üíæ Save Changes</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê -->
<div class="toast" id="toast">
  <div class="toast-icon" id="toast-icon">üîî</div>
  <div><div class="toast-title" id="toast-title">Alert</div><div class="toast-msg" id="toast-msg">Message</div></div>
  <button class="toast-close" onclick="hideToast()">‚úï</button>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATA MODEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SIGNALS = [
  { key:'hr',    name:'Heart Rate',     short:'HR',   unit:'bpm',    icon:'‚ù§Ô∏è',  color:'#C0392B', bg:'#FDECEA', base:72,   std:8,    range:[50,130], lo:55,  hi:100  },
  { key:'hrv',   name:'HRV (RMSSD)',    short:'HRV',  unit:'ms',     icon:'üíõ',  color:'#1A5C9C', bg:'#E6EEF8', base:45,   std:8,    range:[10,80],  lo:20,  hi:70   },
  { key:'spo2',  name:'SpO‚ÇÇ',          short:'SpO‚ÇÇ', unit:'%',      icon:'ü©µ',  color:'#0A7B6C', bg:'#E0F4F1', base:98.5, std:1.2,  range:[88,100], lo:94,  hi:100  },
  { key:'temp',  name:'Temperature',   short:'Temp', unit:'¬∞C',     icon:'üå°Ô∏è', color:'#C97B1A', bg:'#FEF3E2', base:36.8, std:0.4,  range:[35.5,42],lo:36,  hi:37.5 },
  { key:'fever', name:'Core Temp',     short:'Core', unit:'¬∞C',     icon:'üî•',  color:'#E74C3C', bg:'#FDECEA', base:36.8, std:0.3,  range:[35,42],  lo:36,  hi:37.8 },
  { key:'resp',  name:'Respiration',   short:'Resp', unit:'br/min', icon:'üí®',  color:'#7B1A9C', bg:'#F3E6F8', base:16,   std:3,    range:[10,28],  lo:12,  hi:22   },
  { key:'gsr',   name:'GSR / Stress',  short:'GSR',  unit:'¬µS',     icon:'‚ö°',  color:'#1A6B1A', bg:'#E6F4E6', base:0.5,  std:0.3,  range:[0.1,3],  lo:0.1, hi:1.5  },
  { key:'steps', name:'Step Count',    short:'Step', unit:'steps',  icon:'üë£',  color:'#0A7B6C', bg:'#E0F4F1', base:0,    std:50,   range:[0,20000],lo:0,   hi:15000 },
];

const BUFSZ = 1200;
const bufs = {};
SIGNALS.forEach(s=>{ bufs[s.key] = Array(BUFSZ).fill(s.key==='steps'?0:s.base); });
// steps & fever separate trackers
let stepsBuf = Array(288).fill(0);   // 24h at 5-min intervals
let tempBuf = Array(144).fill(36.8); // 24h at 10-min intervals
let totalSteps = 0;
let todayStepGoal = 10000;
let waterCount = 0;

let tick=0, paused=false, scenario='normal', scenTick=0;
let totalSamples=0, sessionStart=Date.now();
let alertLogData=[], alertCounts={total:0,critical:0,high:0,elevated:0,resolved:0};
let currentFilter='all', lastAlertLevel='normal', lastAlertMs=0;
let micActive=false, micStream=null, micAnalyser=null, micSessionStart=null;
let micDetectionCounts={cough:0,smoking:0,drinking:0,sneeze:0,snore:0};
let micTotalDetections=0, micLogEntries=[];
let micAnimFrame=null;

const TEAL='#0A7B6C', AMBER='#C97B1A', ORG='#B85A00', RED='#C0392B';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCENARIOS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function randn(sd=1){ let u,v; do u=Math.random();while(!u);do v=Math.random();while(!v);return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)*sd; }
function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

const scenarioFns = {
  normal:      t=>({hr:72+3*Math.sin(t/30)+randn(1.2),hrv:45+randn(3.5),spo2:98.5+randn(.2),temp:36.8+randn(.06),fever:36.8+randn(.05),resp:16+randn(.7),gsr:.5+randn(.03)}),
  cardiac:     t=>{const p=Math.min(t/200,1);return{hr:72+p*42+randn(3),hrv:45-p*32+randn(2),spo2:98.5-p*2.5+randn(.3),temp:36.8+p*.4+randn(.07),fever:36.8+p*.5+randn(.06),resp:16+p*8+randn(1),gsr:.5+p*1.4+randn(.07)}},
  hypoxia:     t=>{const p=Math.min(t/250,1);return{hr:72+p*18+randn(2),hrv:45-p*15+randn(2.5),spo2:98.5-p*7.5+randn(.2),temp:36.8+randn(.08),fever:36.8+randn(.07),resp:16+p*10+randn(1.2),gsr:.5+p*.5+randn(.04)}},
  infection:   t=>{const p=Math.min(t/300,1);return{hr:72+p*22+randn(2),hrv:45-p*20+randn(2.5),spo2:98.5-p*.8+randn(.25),temp:36.8+p*1.8+randn(.1),fever:36.8+p*2.1+randn(.12),resp:16+p*4+randn(.9),gsr:.5+p+randn(.08)}},
  fever:       t=>{const p=Math.min(t/200,1);return{hr:72+p*26+randn(2.5),hrv:45-p*22+randn(2),spo2:98.5-p*1.2+randn(.3),temp:36.8+p*3.2+randn(.15),fever:36.8+p*3.5+randn(.18),resp:16+p*5+randn(1),gsr:.5+p*.6+randn(.06)}},
  overexertion:t=>{const p=Math.min(t/150,1);return{hr:72+p*55+Math.sin(t/80)*5+randn(3.5),hrv:45-p*38+randn(1.8),spo2:98.5-p*3.5+randn(.35),temp:36.8+p*.9+randn(.09),fever:36.8+p*1.0+randn(.1),resp:16+p*14+randn(1.8),gsr:.5+p*2+randn(.12)}},
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HRI ENGINE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function computeHRI(vals){
  const sigs = SIGNALS.filter(s=>s.key!=='steps'&&s.key!=='fever');
  let maha2=0;
  sigs.forEach(s=>{const z=(vals[s.key]-s.base)/s.std;maha2+=z*z;});
  const mS=Math.min(maha2/25,1);
  let lstm=0;
  sigs.forEach(s=>{const r=bufs[s.key].slice(-60);const m=r.reduce((a,b)=>a+b,0)/r.length;lstm+=Math.abs(vals[s.key]-m)/s.std;});
  const lS=Math.min(lstm/10,1);
  let xgb=0;
  if(vals.hr>100)xgb+=.28;if(vals.hrv<25)xgb+=.22;if(vals.spo2<95)xgb+=.38;if(vals.temp>37.8)xgb+=.22;if(vals.fever>38.0)xgb+=.25;if(vals.resp>22)xgb+=.14;xgb=Math.min(xgb,1);
  const hri=clamp(Math.round(100*(0.35*mS+0.45*lS+0.20*xgb)),0,100);
  return{hri,maha:maha2.toFixed(1),lstm:lstm.toFixed(1)};
}

function hriMeta(hri){
  if(hri<=30) return{level:'normal',   label:'Normal',   color:TEAL, bg:'var(--teal-lt)', icon:'‚úì', title:'All signals within your personal baseline', desc:"Your multi-signal correlation patterns are stable. No abnormal relationships detected."};
  if(hri<=55) return{level:'elevated', label:'Elevated', color:AMBER,bg:'var(--amber-lt)',icon:'‚ö†', title:'Mild deviation from your normal pattern',    desc:"Some biosignals are showing early deviations. HR and HRV coupling is slightly off baseline. Monitor for changes."};
  if(hri<=75) return{level:'high',     label:'High Risk',color:ORG,  bg:'#FFF0E6',        icon:'‚ö°', title:'Multi-signal anomaly detected',              desc:"Significant correlation shift detected. HR, HRV, and SpO‚ÇÇ deviating together ‚Äî a pattern threshold-based monitors miss."};
  if(hri<=89) return{level:'critical', label:'Critical', color:RED,  bg:'var(--red-lt)',  icon:'üö®', title:'Critical physiological pattern ‚Äî act now',   desc:"Multiple critical signals deviating simultaneously. Pattern consistent with acute cardiac stress or severe hypoxia."};
  return               {level:'emergency',label:'EMERGENCY',color:'#8B0000',bg:'#FFEBEE', icon:'üÜò', title:'EMERGENCY ‚Äî Seek immediate help',             desc:"Emergency-level physiological crisis detected across all biosignals. Call emergency services immediately."};
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BUILD UI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildSignalGrid(){
  const grid=document.getElementById('signal-grid');
  grid.innerHTML='';
  SIGNALS.filter(s=>s.key!=='steps').forEach(s=>{
    const card=document.createElement('div');
    card.className='sig-card fadein'; card.id=`sigcard-${s.key}`;
    card.innerHTML=`
      <div class="sig-card-top">
        <div class="sig-icon" style="background:${s.bg}">${s.icon}</div>
        <div class="sig-status-dot" id="sd-${s.key}"></div>
      </div>
      <div class="sig-name">${s.name}</div>
      <div class="sig-val-row">
        <span class="sig-val" id="sv-${s.key}" style="color:${s.color}">--</span>
        <span class="sig-unit">${s.unit}</span>
      </div>
      <div class="sig-range" id="sr-${s.key}">Normal: ${s.lo}‚Äì${s.hi} ${s.unit}</div>
      <div class="sig-bar-track"><div class="sig-bar-fill" id="sb-${s.key}" style="background:${s.color}"></div></div>
      <div class="sig-mini-wrap"><canvas class="sig-mini" id="sm-${s.key}" height="34"></canvas></div>
      <div class="sig-trend" id="st-${s.key}"><span>‚Üî</span><span style="margin-left:2px">Stable</span></div>`;
    grid.appendChild(card);
  });
  // Steps card special
  const stepsCard=document.createElement('div');
  stepsCard.className='sig-card fadein'; stepsCard.id='sigcard-steps';
  stepsCard.innerHTML=`
    <div class="sig-card-top">
      <div class="sig-icon" style="background:var(--teal-lt)">üë£</div>
      <div class="sig-status-dot" id="sd-steps" style="background:var(--green)"></div>
    </div>
    <div class="sig-name">Step Count</div>
    <div class="steps-ring-container">
      <div class="steps-info">
        <div class="steps-val" id="sv-steps">0</div>
        <div class="steps-goal" id="steps-goal-text">Goal: ${todayStepGoal.toLocaleString()} ¬∑ 0%</div>
        <div class="steps-badges" id="steps-badges-card"></div>
      </div>
      <canvas id="steps-donut-card" width="60" height="60" style="display:block;flex-shrink:0"></canvas>
    </div>
    <div style="margin-top:8px;height:4px;background:var(--cream2);border-radius:2px;overflow:hidden">
      <div id="steps-card-bar" style="height:100%;background:var(--teal);border-radius:2px;transition:width .5s;width:0%"></div>
    </div>`;
  grid.appendChild(stepsCard);
}

function buildCorrGrid(){
  const sigs=SIGNALS.filter(s=>s.key!=='steps'&&s.key!=='fever');
  const n=sigs.length;
  const grid=document.getElementById('corr-heatmap');
  const cols=document.getElementById('corr-col-labels');
  grid.innerHTML='';cols.innerHTML='';
  grid.style.cssText=`display:grid;grid-template-columns:repeat(${n},1fr);gap:2px`;
  cols.style.cssText=`display:grid;grid-template-columns:repeat(${n},1fr);gap:2px`;
  sigs.forEach((s1,i)=>{
    sigs.forEach((s2,j)=>{
      const c=document.createElement('div');c.className='corr-cell';c.id=`cc-${i}-${j}`;c.title=`${s1.short}‚Üî${s2.short}`;
      if(i===j){c.style.background='#E0F4F1';c.textContent='1';c.style.color=TEAL;c.style.fontWeight='800';}
      grid.appendChild(c);
    });
  });
  sigs.forEach(s=>{const d=document.createElement('div');d.className='corr-col-label';d.textContent=s.short;cols.appendChild(d);});
}

function buildBaselineBars(){
  const c=document.getElementById('baseline-bars');c.innerHTML='';
  SIGNALS.filter(s=>s.key!=='steps').forEach(s=>{
    const pct=((s.base-s.range[0])/(s.range[1]-s.range[0])*100).toFixed(0);
    const dec=s.key==='spo2'||s.key==='temp'||s.key==='fever'?1:(s.key==='gsr'?2:0);
    c.innerHTML+=`<div class="baseline-row">
      <span class="baseline-sig-name">${s.icon} ${s.name}</span>
      <div class="baseline-track"><div class="baseline-fill" style="width:${pct}%;background:${s.color}"></div></div>
      <span class="baseline-val" style="color:${s.color}">${s.base.toFixed(dec)} ${s.unit}</span>
    </div>`;
  });
}

function buildSensorGrid(){
  const sensors=[
    {id:'max30105',name:'MAX30105',desc:'SpO‚ÇÇ & Heart Rate',icon:'‚ù§Ô∏è',state:'connected'},
    {id:'ad8232',name:'AD8232',desc:'ECG / HRV Monitor',icon:'üì°',state:'connected'},
    {id:'ds18b20',name:'DS18B20',desc:'Body Temperature',icon:'üå°Ô∏è',state:'connected'},
    {id:'gsr',name:'GSR Module',desc:'Galvanic Skin Response',icon:'‚ö°',state:'connected'},
    {id:'mpu6050',name:'MPU-6050',desc:'Accelerometer / Steps',icon:'üë£',state:'connected'},
    {id:'ntc',name:'NTC Thermistor',desc:'Ambient Temperature',icon:'üå°Ô∏è',state:'searching'},
    {id:'mic',name:'MEMS Microphone',desc:'Behaviour Detection',icon:'üéôÔ∏è',state:'error'},
    {id:'esp32',name:'ESP32 WROOM-32',desc:'Main Controller',icon:'üîå',state:'connected'},
  ];
  const grid=document.getElementById('sensor-grid');grid.innerHTML='';
  sensors.forEach(s=>{
    const cls=s.state==='connected'?'connected':s.state==='error'?'error':'searching';
    const statusIcon=s.state==='connected'?'‚óè':s.state==='error'?'‚úï':'‚óå';
    const statusLabel=s.state==='connected'?'Connected':s.state==='error'?'Error':'Searching...';
    const statusCls=s.state==='connected'?'ok':s.state==='error'?'err':'search';
    const card=document.createElement('div');
    card.className=`sensor-card ${cls}`;card.onclick=()=>toggleSensor(s.id,card);
    card.innerHTML=`<div class="sensor-icon">${s.icon}</div><div style="flex:1"><div class="sensor-name">${s.name}</div><div class="sensor-desc">${s.desc}</div><div class="sensor-status ${statusCls}" id="ss-${s.id}"><span class="sensor-dot" style="background:${s.state==='connected'?'var(--teal)':s.state==='error'?'var(--red)':'var(--amber)'}"></span>${statusLabel}</div></div>`;
    grid.appendChild(card);
  });
}

function buildThresholdSettings(){
  const container=document.getElementById('threshold-settings');container.innerHTML='';
  SIGNALS.filter(s=>s.key!=='steps').forEach(s=>{
    const dec=s.key==='spo2'||s.key==='temp'||s.key==='fever'?1:s.key==='gsr'?2:0;
    container.innerHTML+=`<div style="margin-bottom:18px;padding-bottom:18px;border-bottom:1px solid var(--border)">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <span>${s.icon}</span>
        <span style="font-size:.85rem;font-weight:600;color:var(--ink)">${s.name}</span>
        <span style="font-size:.72rem;color:var(--ink3)">(${s.unit})</span>
      </div>
      <div class="form-row">
        <div class="form-group">
          <div class="form-label">Low Alert Threshold <span style="color:var(--blue)" id="th-lo-val-${s.key}">${s.lo}</span></div>
          <input type="range" class="range-slider" min="${s.range[0]}" max="${s.base}" step="${dec?0.1:1}" value="${s.lo}" oninput="s_updateTh('lo','${s.key}',this.value);document.getElementById('th-lo-val-${s.key}').textContent=parseFloat(this.value).toFixed(${dec})">
        </div>
        <div class="form-group">
          <div class="form-label">High Alert Threshold <span style="color:var(--red)" id="th-hi-val-${s.key}">${s.hi}</span></div>
          <input type="range" class="range-slider" min="${s.base}" max="${s.range[1]}" step="${dec?0.1:1}" value="${s.hi}" oninput="s_updateTh('hi','${s.key}',this.value);document.getElementById('th-hi-val-${s.key}').textContent=parseFloat(this.value).toFixed(${dec})">
        </div>
      </div>
    </div>`;
  });
}

function s_updateTh(lohi,key,val){
  const s=SIGNALS.find(x=>x.key===key);
  if(s){if(lohi==='lo')s.lo=parseFloat(val);else s.hi=parseFloat(val);}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DRAW FUNCTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function drawMini(key){
  const canvas=document.getElementById(`sm-${key}`);if(!canvas)return;
  const s=SIGNALS.find(x=>x.key===key);
  const dpr=window.devicePixelRatio||1;
  const W=canvas.offsetWidth||180,H=34;
  canvas.width=W*dpr;canvas.height=H*dpr;
  canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const data=bufs[key].slice(-150);const n=data.length;if(n<2)return;
  const mn=s.range[0],mx=s.range[1];
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle=s.color;ctx.lineWidth=1.5;ctx.lineJoin='round';ctx.lineCap='round';
  ctx.beginPath();
  for(let i=0;i<n;i++){const x=(i/(n-1))*(W-2)+1;const y=H-2-(data[i]-mn)/(mx-mn)*(H-4);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}
  ctx.stroke();
  const grad=ctx.createLinearGradient(0,0,0,H);grad.addColorStop(0,s.color+'30');grad.addColorStop(1,s.color+'00');
  ctx.fillStyle=grad;ctx.lineTo(W-1,H);ctx.lineTo(1,H);ctx.closePath();ctx.fill();
}

function drawHRI(score){
  const canvas=document.getElementById('hri-canvas');if(!canvas)return;
  const dpr=window.devicePixelRatio||1;const W=160,H=160;
  canvas.width=W*dpr;canvas.height=H*dpr;
  canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,W,H);
  const cx=80,cy=88,R=62;const sa=Math.PI*.75,ea=Math.PI*2.25;
  ctx.strokeStyle='#EDE8DC';ctx.lineWidth=14;ctx.lineCap='round';
  ctx.beginPath();ctx.arc(cx,cy,R,sa,ea);ctx.stroke();
  const zones=[{from:0,to:.3,c:'#1A7B4A20'},{from:.3,to:.55,c:'#C97B1A20'},{from:.55,to:.75,c:'#B85A0020'},{from:.75,to:.9,c:'#C0392B25'},{from:.9,to:1,c:'#8B000030'}];
  zones.forEach(z=>{const a1=sa+z.from*(ea-sa),a2=sa+z.to*(ea-sa);ctx.strokeStyle=z.c;ctx.lineWidth=14;ctx.beginPath();ctx.arc(cx,cy,R,a1,a2);ctx.stroke();});
  const t=score/100;const fillEnd=sa+t*(ea-sa);
  const meta=hriMeta(score);
  const grad=ctx.createLinearGradient(cx-R,cy,cx+R,cy);
  grad.addColorStop(0,'#1A7B4A');grad.addColorStop(.4,'#C97B1A');grad.addColorStop(.7,'#C0392B');grad.addColorStop(1,'#8B0000');
  ctx.strokeStyle=grad;ctx.lineWidth=14;ctx.lineCap='round';
  ctx.beginPath();ctx.arc(cx,cy,R,sa,fillEnd);ctx.stroke();
  for(let i=0;i<=10;i++){const a=sa+i/10*(ea-sa);const x1=cx+(R-10)*Math.cos(a),y1=cy+(R-10)*Math.sin(a);const x2=cx+(R+0)*Math.cos(a),y2=cy+(R+0)*Math.sin(a);ctx.strokeStyle='rgba(255,255,255,.6)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();}
  const na=sa+t*(ea-sa);
  ctx.save();ctx.translate(cx,cy);ctx.strokeStyle=meta.color;ctx.lineWidth=3;ctx.lineCap='round';ctx.shadowColor=meta.color;ctx.shadowBlur=8;
  ctx.beginPath();ctx.moveTo(-8*Math.cos(na),-8*Math.sin(na));ctx.lineTo((R-8)*Math.cos(na),(R-8)*Math.sin(na));ctx.stroke();
  ctx.shadowBlur=0;ctx.fillStyle=meta.color;ctx.beginPath();ctx.arc(0,0,6,0,Math.PI*2);ctx.fill();ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(0,0,3,0,Math.PI*2);ctx.fill();
  ctx.restore();
}

function drawStepsDonut(canvasId,steps,goal){
  const canvas=document.getElementById(canvasId);if(!canvas)return;
  const dpr=window.devicePixelRatio||1;
  const W=canvas.offsetWidth||120,H=canvas.offsetHeight||120;
  canvas.width=W*dpr;canvas.height=H*dpr;
  canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,W,H);
  const cx=W/2,cy=H/2,R=Math.min(W,H)/2-4,lw=8;
  const pct=Math.min(steps/goal,1);
  ctx.strokeStyle='#EDE8DC';ctx.lineWidth=lw;ctx.lineCap='round';
  ctx.beginPath();ctx.arc(cx,cy,R,-Math.PI/2,-Math.PI/2+Math.PI*2);ctx.stroke();
  if(pct>0){
    const grad=ctx.createLinearGradient(0,0,W,H);
    grad.addColorStop(0,TEAL);grad.addColorStop(1,'#0D9982');
    ctx.strokeStyle=grad;ctx.lineWidth=lw;ctx.lineCap='round';
    ctx.beginPath();ctx.arc(cx,cy,R,-Math.PI/2,-Math.PI/2+pct*Math.PI*2);ctx.stroke();
  }
  ctx.fillStyle=TEAL;ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.font=`bold ${Math.round(W*0.14)}px 'Instrument Sans'`;
  ctx.fillText(Math.round(pct*100)+'%',cx,cy);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STEPS & FEVER UPDATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateStepsUI(){
  const pct=Math.min(totalSteps/todayStepGoal,1);
  const pctStr=(pct*100).toFixed(0)+'%';
  document.getElementById('sv-steps').textContent=totalSteps.toLocaleString();
  document.getElementById('steps-goal-text').textContent=`Goal: ${todayStepGoal.toLocaleString()} ¬∑ ${pctStr}`;
  document.getElementById('steps-card-bar').style.width=(pct*100)+'%';
  document.getElementById('meta-steps').textContent=totalSteps.toLocaleString();
  // Wellness page
  document.getElementById('wellness-steps').textContent=totalSteps.toLocaleString();
  document.getElementById('wellness-steps-goal').textContent=`Goal: ${todayStepGoal.toLocaleString()} ¬∑ ${pctStr}`;
  document.getElementById('steps-progress-bar').style.width=(pct*100)+'%';
  document.getElementById('ws-calories').textContent=Math.round(totalSteps*0.04);
  document.getElementById('ws-distance').textContent=(totalSteps*0.00076).toFixed(1);
  document.getElementById('ws-active').textContent=Math.round(totalSteps/100);
  document.getElementById('ws-floors').textContent=Math.round(totalSteps/1500);
  document.getElementById('g-steps').textContent=`${totalSteps.toLocaleString()} / ${todayStepGoal.toLocaleString()}`;
  document.getElementById('gbar-steps').style.width=(pct*100)+'%';
  document.getElementById('g-calories').textContent=`${Math.round(totalSteps*0.04)} / 2200`;
  document.getElementById('gbar-calories').style.width=Math.min(totalSteps*0.04/22,100)+'%';
  drawStepsDonut('steps-donut',totalSteps,todayStepGoal);
  drawStepsDonut('steps-donut-card',totalSteps,todayStepGoal);
  // Badges
  const badges=[];
  if(totalSteps>=2500)badges.push({label:'Early Bird',color:'#1A7B4A',bg:'#E6F4EE'});
  if(totalSteps>=5000)badges.push({label:'Halfway',color:'#C97B1A',bg:'#FEF3E2'});
  if(totalSteps>=7500)badges.push({label:'Active',color:'#1A5C9C',bg:'#E6EEF8'});
  if(totalSteps>=10000)badges.push({label:'Goal! üéâ',color:'#0A7B6C',bg:'#E0F4F1'});
  const html=badges.map(b=>`<span class="steps-badge" style="background:${b.bg};color:${b.color}">${b.label}</span>`).join('');
  document.getElementById('steps-badges-card').innerHTML=html;
  if(document.getElementById('steps-badges'))document.getElementById('steps-badges').innerHTML=html;
}

function updateFeverUI(temp){
  const el=document.getElementById('fever-big-val');if(el)el.textContent=temp.toFixed(1);
  document.getElementById('meta-fever').textContent=temp.toFixed(1)+'¬∞';
  // Zone classification
  let status,color,bg;
  if(temp<36){status='Hypothermic';color='#1A7B4A';bg='var(--teal-lt)';}
  else if(temp<36.5){status='Sub-normal';color='#0A7B6C';bg='var(--teal-lt)';}
  else if(temp<=37.5){status='Normal';color='#1A7B4A';bg:'var(--green-lt)';}
  else if(temp<=38.0){status='Low-grade Fever';color:'#C97B1A';bg='var(--amber-lt)';}
  else if(temp<=39.0){status='Fever';color:'#E67E22';bg='var(--amber-lt)';}
  else if(temp<=40.0){status='High Fever üö®';color:'#C0392B';bg='var(--red-lt)';}
  else{status='Hyperpyrexia ‚ö†Ô∏è';color:'#8B0000';bg='#FFEBEE';}
  const badge=document.getElementById('fever-status-badge');
  if(badge){badge.textContent=(temp<=37.5?'‚úì ':temp<=38?'‚ö† ':'üö® ')+status;badge.style.color=color;badge.style.background=bg;}
  // Arrow position (pct of 35 to 41 range = 6¬∞)
  const arrowPct=Math.max(0,Math.min(100,(temp-35)/6*100));
  const arrowEl=document.getElementById('fever-arrow');if(arrowEl)arrowEl.style.left=`calc(${arrowPct}% - 8px)`;
  // Fever signal card
  const sv=document.getElementById('sv-fever');if(sv)sv.textContent=temp.toFixed(1);
  // Stats
  tempBuf.push(temp);if(tempBuf.length>144)tempBuf.shift();
  const todayTemps=tempBuf.filter(v=>v>0);
  if(todayTemps.length){
    document.getElementById('temp-min').textContent=Math.min(...todayTemps).toFixed(1);
    document.getElementById('temp-max').textContent=Math.max(...todayTemps).toFixed(1);
    document.getElementById('temp-avg').textContent=(todayTemps.reduce((a,b)=>a+b,0)/todayTemps.length).toFixed(1);
    const recent=tempBuf.slice(-6);
    const trend=recent[recent.length-1]-recent[0];
    document.getElementById('temp-trend-val').textContent=trend>0.2?'Rising‚Üë':trend<-0.2?'Falling‚Üì':'Stable';
  }
  drawFeverMiniChart(temp);
}

function drawFeverMiniChart(currentTemp){
  const canvas=document.getElementById('fever-mini-chart');if(!canvas)return;
  const dpr=window.devicePixelRatio||1;const W=canvas.offsetWidth||300,H=60;
  canvas.width=W*dpr;canvas.height=H*dpr;
  canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,W,H);
  const data=tempBuf.slice(-60);const n=data.length;if(n<2)return;
  const mn=35.5,mx=40.5;
  // Fever threshold line
  const fy=H-(38-mn)/(mx-mn)*H;
  ctx.strokeStyle='rgba(192,57,43,.25)';ctx.lineWidth=1;ctx.setLineDash([4,4]);
  ctx.beginPath();ctx.moveTo(0,fy);ctx.lineTo(W,fy);ctx.stroke();ctx.setLineDash([]);
  ctx.strokeStyle=AMBER;ctx.lineWidth=2;ctx.lineCap='round';ctx.lineJoin='round';
  ctx.beginPath();
  for(let i=0;i<n;i++){const x=(i/(n-1))*W;const y=H-2-(data[i]-mn)/(mx-mn)*(H-4);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}
  ctx.stroke();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN UPDATE LOOP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let lastCorrTick=0;
function update(){
  if(paused)return;
  tick++;scenTick++;totalSamples++;
  // Simulate steps accumulating during day
  if(tick%50===0&&totalSteps<todayStepGoal*1.1){
    totalSteps+=Math.round(Math.random()*8+2);
    updateStepsUI();
  }
  const fn=scenarioFns[scenario]||scenarioFns.normal;
  const raw=fn(scenTick);
  const vals={};
  SIGNALS.forEach(s=>{
    if(s.key==='steps'){vals[s.key]=totalSteps;return;}
    vals[s.key]=clamp(parseFloat((raw[s.key]??s.base).toFixed(2)),s.range[0],s.range[1]);
  });
  SIGNALS.forEach(s=>{bufs[s.key].push(vals[s.key]);if(bufs[s.key].length>BUFSZ)bufs[s.key].shift();});
  const {hri,maha,lstm}=computeHRI(vals);
  const meta=hriMeta(hri);
  drawHRI(hri);
  document.getElementById('hri-num').textContent=hri;
  document.getElementById('hri-num').style.color=meta.color;
  const badge=document.getElementById('hri-badge');
  badge.textContent='‚óè '+meta.label;badge.style.color=meta.color;badge.style.background=meta.bg;badge.style.border=`1.5px solid ${meta.color}40`;
  document.getElementById('hri-title').textContent=meta.title;
  document.getElementById('hri-desc').textContent=meta.desc;
  document.getElementById('meta-maha').textContent=maha;
  document.getElementById('meta-lstm').textContent=lstm;
  document.getElementById('meta-samples').textContent=totalSamples;
  const sec=Math.floor((Date.now()-sessionStart)/1000);
  document.getElementById('meta-uptime').textContent=sec<60?sec+'s':Math.floor(sec/60)+'m';
  document.getElementById('monitor-time').textContent=`Updated ${new Date().toLocaleTimeString()} ‚Äî 10 Hz`;
  // Update fever
  updateFeverUI(vals.fever);
  // Signal cards
  SIGNALS.filter(s=>s.key!=='steps').forEach(s=>{
    const v=vals[s.key];
    const dec=s.key==='spo2'||s.key==='temp'||s.key==='fever'?1:s.key==='gsr'?2:0;
    const el=document.getElementById(`sv-${s.key}`);if(el)el.textContent=v.toFixed(dec);
    const pct=((v-s.range[0])/(s.range[1]-s.range[0])*100).toFixed(1);
    const bar=document.getElementById(`sb-${s.key}`);if(bar)bar.style.width=pct+'%';
    const dot=document.getElementById(`sd-${s.key}`);
    const card=document.getElementById(`sigcard-${s.key}`);
    const isAnom=(v<s.lo||v>s.hi);
    if(dot){dot.style.background=isAnom?RED:'#1A7B4A';dot.style.boxShadow=isAnom?`0 0 5px ${RED}`:'none';}
    if(card){isAnom?card.classList.add('alert-anim'):card.classList.remove('alert-anim');}
    if(tick%3===0)drawMini(s.key);
    // Trend arrow
    const buf=bufs[s.key];const recent=buf.slice(-20);const prev=buf.slice(-40,-20);
    const rMean=recent.reduce((a,b)=>a+b,0)/recent.length;const pMean=prev.reduce((a,b)=>a+b,0)/prev.length;
    const diff=rMean-pMean;
    const tEl=document.getElementById(`st-${s.key}`);
    if(tEl){const arrow=diff>s.std*.3?'‚Üë':diff<-s.std*.3?'‚Üì':'‚Üî';const col=Math.abs(diff)>s.std*.5?s.color:'var(--ink3)';tEl.innerHTML=`<span style="color:${col}">${arrow}</span><span style="margin-left:2px;color:var(--ink3)">${Math.abs(diff)<0.01?'Stable':diff>0?'Rising':'Falling'}</span>`;}
  });
  if(tick-lastCorrTick>=50){lastCorrTick=tick;updateCorrMatrix();}
  if(meta.level!==lastAlertLevel){
    if(meta.level!=='normal')triggerAlert(hri,meta,vals);
    else resolveAlert();
    lastAlertLevel=meta.level;
  }
  // Active alert banner
  const banner=document.getElementById('active-alert-banner');
  if(meta.level!=='normal'){
    banner.classList.add('show');banner.style.borderLeftColor=meta.color;banner.style.borderColor=meta.color+'50';
    document.getElementById('ab-icon').textContent=meta.icon;
    document.getElementById('ab-level').textContent=meta.label;document.getElementById('ab-level').style.color=meta.color;
    document.getElementById('ab-time').textContent=new Date().toLocaleTimeString();
    document.getElementById('ab-msg').textContent=meta.desc;
    const chips=document.getElementById('ab-signals');chips.innerHTML='';
    SIGNALS.filter(s=>s.key!=='steps').forEach(s=>{const v=vals[s.key];const anom=v<s.lo||v>s.hi;if(anom){const dec=s.key==='spo2'||s.key==='temp'||s.key==='fever'?1:s.key==='gsr'?2:0;chips.innerHTML+=`<span class="signal-chip" style="background:${s.bg};color:${s.color}">${s.icon} ${s.short}: ${v.toFixed(dec)}</span>`;}});
  }else{banner.classList.remove('show');}
}

function updateCorrMatrix(){
  const sigs=SIGNALS.filter(s=>s.key!=='steps'&&s.key!=='fever');
  sigs.forEach((s1,i)=>{
    sigs.forEach((s2,j)=>{
      if(i===j)return;
      const a=bufs[s1.key].slice(-100),b=bufs[s2.key].slice(-100);
      const n=a.length;const ma=a.reduce((x,y)=>x+y,0)/n,mb=b.reduce((x,y)=>x+y,0)/n;
      let nm=0,da=0,db=0;
      for(let k=0;k<n;k++){const ea=a[k]-ma,eb=b[k]-mb;nm+=ea*eb;da+=ea*ea;db+=eb*eb;}
      const r=(da&&db)?nm/Math.sqrt(da*db):0;
      const c=document.getElementById(`cc-${i}-${j}`);if(!c)return;
      const abs=Math.abs(r);
      c.style.background=r>0?`rgba(10,123,108,${0.08+0.7*abs})`:`rgba(192,57,43,${0.08+0.7*abs})`;
      c.textContent=r.toFixed(1);c.style.color=abs>0.4?'#fff':(r>0?TEAL:RED);c.style.fontSize=abs>0.5?'.58rem':'.5rem';
    });
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ALERTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function triggerAlert(hri,meta,vals){
  const now=Date.now();if(now-lastAlertMs<4000)return;
  lastAlertMs=now;
  alertCounts.total++;
  if(meta.level==='critical'||meta.level==='emergency')alertCounts.critical++;
  else if(meta.level==='high')alertCounts.high++;
  else alertCounts.elevated++;
  document.getElementById('astat-total').textContent=alertCounts.total;
  document.getElementById('astat-critical').textContent=alertCounts.critical;
  document.getElementById('astat-high').textContent=alertCounts.high;
  document.getElementById('ps-alerts').textContent=alertCounts.total;
  const nb=document.getElementById('alert-nav-badge');nb.textContent=alertCounts.total;nb.classList.add('show');
  const entry={id:alertCounts.total,hri,level:meta.level,label:meta.label,color:meta.color,bg:meta.bg,icon:meta.icon,title:meta.title,desc:meta.desc,time:new Date().toLocaleTimeString(),
    signals:SIGNALS.filter(s=>s.key!=='steps'&&(vals[s.key]<s.lo||vals[s.key]>s.hi)).map(s=>{const dec=s.key==='spo2'||s.key==='temp'||s.key==='fever'?1:s.key==='gsr'?2:0;return{key:s.key,short:s.short,icon:s.icon,val:vals[s.key].toFixed(dec),color:s.color,bg:s.bg}})};
  alertLogData.unshift(entry);renderAlertList();
  showToast(meta.icon+' '+meta.label,`HRI ${hri} ‚Äî ${meta.title}`,meta.level);
}
function resolveAlert(){alertCounts.resolved=(alertCounts.resolved||0)+1;document.getElementById('astat-resolved').textContent=alertCounts.resolved;}
function renderAlertList(){
  const list=document.getElementById('alert-list');
  const filtered=currentFilter==='all'?alertLogData:alertLogData.filter(a=>a.level===currentFilter||a.category===currentFilter);
  if(filtered.length===0){list.innerHTML='<div class="empty-state"><div class="empty-state-icon">üîî</div>No alerts matching this filter.</div>';return;}
  list.innerHTML='';
  filtered.forEach(a=>{
    const row=document.createElement('div');row.className='alert-row fadein';
    const sigChips=a.signals.map(s=>`<span class="signal-chip" style="background:${s.bg};color:${s.color}">${s.icon} ${s.short}: ${s.val}</span>`).join('');
    row.innerHTML=`<div class="alert-row-icon" style="background:${a.bg}">${a.icon}</div>
      <div class="alert-row-body">
        <div class="alert-row-top"><span class="alert-row-level" style="background:${a.bg};color:${a.color}">${a.label}</span><span class="alert-row-hri" style="color:${a.color}">HRI ${a.hri}</span><span class="alert-row-time">${a.time}</span></div>
        <div class="alert-row-title">${a.title}</div>
        <div class="alert-row-desc">${a.desc}</div>
        ${sigChips?`<div class="alert-row-signals">${sigChips}</div>`:''}
      </div>`;
    list.appendChild(row);
  });
}
function filterAlerts(f,btn){currentFilter=f;document.querySelectorAll('.filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderAlertList();}
function clearAlerts(){alertLogData=[];alertCounts={total:0,critical:0,high:0,elevated:0,resolved:0};document.getElementById('astat-total').textContent='0';document.getElementById('astat-critical').textContent='0';document.getElementById('astat-high').textContent='0';document.getElementById('astat-resolved').textContent='0';document.getElementById('alert-nav-badge').classList.remove('show');document.getElementById('ps-alerts').textContent='0';renderAlertList();}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MICROPHONE / BEHAVIOUR AI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const BEHAVIOURS=[
  {key:'cough',label:'Coughing',icon:'üòÆ‚Äçüí®',color:'#C0392B',desc:'Repetitive forced exhalation detected'},
  {key:'smoking',label:'Smoking',icon:'üö¨',color:'#6B5E56',desc:'Prolonged inhale-exhale pattern detected'},
  {key:'drinking',label:'Drinking',icon:'üíß',color:'#1A5C9C',desc:'Swallowing sound sequence detected'},
  {key:'sneeze',label:'Sneezing',icon:'ü§ß',color:'#E67E22',desc:'Sudden burst exhalation detected'},
  {key:'snore',label:'Snoring',icon:'üò¥',color:'#7B1A9C',desc:'Rhythmic airway vibration detected'},
];

// Simulated confidence values (realistic-looking)
let behaviourConfs={cough:0,smoking:0,drinking:0,sneeze:0,snore:0};
let micTick=0;

function buildBehaviourPanel(){
  const container=document.getElementById('behaviour-detections');container.innerHTML='';
  BEHAVIOURS.forEach(b=>{
    container.innerHTML+=`<div class="mic-det-row">
      <div class="mic-det-label">${b.icon} <span>${b.label}</span></div>
      <div class="mic-det-bar"><div class="mic-det-fill" id="mic-fill-${b.key}" style="width:0%"></div></div>
      <div class="mic-det-conf" id="mic-conf-${b.key}">0%</div>
    </div>`;
  });
}

async function toggleMic(){
  if(!micActive){
    try{
      if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){
        micStream=await navigator.mediaDevices.getUserMedia({audio:true});
        const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
        micAnalyser=audioCtx.createAnalyser();
        micAnalyser.fftSize=256;
        const source=audioCtx.createMediaStreamSource(micStream);
        source.connect(micAnalyser);
        startMicVis(micAnalyser);
        showToast('üéôÔ∏è Microphone Active','Real-time behaviour detection started','normal');
      }else{
        // Demo mode if no mic available
        startMicDemo();
      }
    }catch(e){startMicDemo();}
    micActive=true;micSessionStart=Date.now();
    document.getElementById('mic-main-btn').textContent='‚èπ Stop Listening';
    document.getElementById('mic-main-btn').className='btn btn-danger btn-sm';
    document.getElementById('nav-mic-btn').classList.add('listening');
    document.getElementById('nav-mic-dot').style.animation='livepulse 1.2s ease-in-out infinite';
    document.getElementById('nav-mic-text').textContent='Mic on';
    document.getElementById('mic-vis-dot').style.animation='livepulse 1.2s ease-in-out infinite';
  }else{
    stopMic();
  }
}

function stopMic(){
  micActive=false;
  if(micStream)micStream.getTracks().forEach(t=>t.stop());
  if(micAnimFrame)cancelAnimationFrame(micAnimFrame);
  document.getElementById('mic-main-btn').textContent='üéôÔ∏è Start Listening';
  document.getElementById('mic-main-btn').className='btn btn-purple btn-sm';
  document.getElementById('nav-mic-btn').classList.remove('listening');
  document.getElementById('nav-mic-dot').style.animation='none';
  document.getElementById('nav-mic-text').textContent='Mic off';
  document.getElementById('mic-vis-dot').style.animation='none';
  clearCanvas('mic-waveform');
  showToast('üéôÔ∏è Microphone Off','Behaviour detection paused','normal');
}

function toggleMicFromNav(){
  if(!micActive)toggleMic();else stopMic();
}

function startMicVis(analyser){
  const canvas=document.getElementById('mic-waveform');
  function draw(){
    micAnimFrame=requestAnimationFrame(draw);
    const dpr=window.devicePixelRatio||1;
    const W=canvas.offsetWidth||300,H=60;
    canvas.width=W*dpr;canvas.height=H*dpr;
    canvas.style.width=W+'px';canvas.style.height=H+'px';
    const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
    ctx.clearRect(0,0,W,H);
    const bufLen=analyser.frequencyBinCount;
    const data=new Uint8Array(bufLen);
    analyser.getByteTimeDomainData(data);
    ctx.strokeStyle='#c46be8';ctx.lineWidth=2;ctx.beginPath();
    for(let i=0;i<bufLen;i++){const x=(i/bufLen)*W;const y=(data[i]/128)*H/2;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}
    ctx.stroke();
    updateBehaviourSim();
  }
  draw();
}

function startMicDemo(){
  const canvas=document.getElementById('mic-waveform');
  function draw(){
    micAnimFrame=requestAnimationFrame(draw);
    if(!micActive)return;
    const dpr=window.devicePixelRatio||1;
    const W=canvas.offsetWidth||300,H=60;
    canvas.width=W*dpr;canvas.height=H*dpr;
    canvas.style.width=W+'px';canvas.style.height=H+'px';
    const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
    ctx.clearRect(0,0,W,H);
    const t=Date.now()/200;
    ctx.strokeStyle='#c46be8';ctx.lineWidth=2;ctx.beginPath();
    for(let i=0;i<W;i++){const y=H/2+Math.sin(i*0.08+t)*(10+Math.sin(t*0.5+i*0.02)*8)+randn(.8)*3;i===0?ctx.moveTo(i,y):ctx.lineTo(i,y);}
    ctx.stroke();
    updateBehaviourSim();
  }
  draw();
}

let lastBehaviourDetect=0;
function updateBehaviourSim(){
  if(!micActive)return;
  micTick++;
  const now=Date.now();
  // Update session time
  if(micSessionStart){const s=Math.floor((now-micSessionStart)/1000);document.getElementById('mic-session-time').textContent=s<60?s+'s':Math.floor(s/60)+'m';}
  // Simulate slowly changing confidence
  BEHAVIOURS.forEach(b=>{
    const target=Math.max(0,Math.min(100,behaviourConfs[b.key]+randn(4)));
    behaviourConfs[b.key]=behaviourConfs[b.key]*0.88+target*0.12;
    const el=document.getElementById(`mic-fill-${b.key}`);
    const conf=document.getElementById(`mic-conf-${b.key}`);
    if(el)el.style.width=behaviourConfs[b.key].toFixed(0)+'%';
    if(conf)conf.textContent=behaviourConfs[b.key].toFixed(0)+'%';
  });
  // Random spike = detection event
  if(micTick%80===0){
    const b=BEHAVIOURS[Math.floor(Math.random()*BEHAVIOURS.length)];
    behaviourConfs[b.key]=Math.min(100,behaviourConfs[b.key]+Math.random()*50+30);
    if(now-lastBehaviourDetect>3000&&behaviourConfs[b.key]>70){
      lastBehaviourDetect=now;
      logBehaviourDetection(b);
    }
  }
  // AI text
  const top=BEHAVIOURS.reduce((a,b)=>behaviourConfs[a.key]>behaviourConfs[b.key]?a:b);
  const aiTexts={
    cough:`Repeated forced exhalation pattern detected. Confidence ${behaviourConfs.cough.toFixed(0)}%. May indicate respiratory irritation or infection.`,
    smoking:`Extended slow-breathing pattern with pause detected. Confidence ${behaviourConfs.smoking.toFixed(0)}%. Monitoring for sustained pattern.`,
    drinking:`Sequential deglutition sounds detected. Confidence ${behaviourConfs.drinking.toFixed(0)}%. Pattern consistent with fluid intake.`,
    sneeze:`Brief high-amplitude acoustic burst detected. Confidence ${behaviourConfs.sneeze.toFixed(0)}%. Consistent with sneezing pattern.`,
    snore:`Low-frequency rhythmic vibration detected. Confidence ${behaviourConfs.snore.toFixed(0)}%. Consistent with sleep apnoea pattern.`,
  };
  const aiEl=document.getElementById('mic-ai-text');
  if(aiEl&&behaviourConfs[top.key]>25)aiEl.textContent=aiTexts[top.key];
  else if(aiEl)aiEl.textContent='Monitoring ambient audio. No significant behavioural pattern detected. Baseline noise level normal.';
}

function logBehaviourDetection(b){
  micTotalDetections++;
  if(b.key==='cough')micDetectionCounts.cough++;
  document.getElementById('mic-detections-count').textContent=micTotalDetections;
  document.getElementById('mic-cough-count').textContent=micDetectionCounts.cough;
  const log=document.getElementById('mic-log');
  const emptyState=log.querySelector('.empty-state');if(emptyState)emptyState.remove();
  const entry=document.createElement('div');
  entry.style.cssText='display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);animation:fadein .3s ease';
  entry.innerHTML=`<span style="font-size:1.1rem">${b.icon}</span><div style="flex:1"><div style="font-size:.8rem;font-weight:600;color:var(--ink)">${b.label}</div><div style="font-size:.7rem;color:var(--ink3)">${b.desc}</div></div><div style="font-size:.7rem;color:var(--ink3)">${new Date().toLocaleTimeString()}</div>`;
  log.insertBefore(entry,log.firstChild);
  // Add to alerts
  const alertEntry={id:alertCounts.total+1,hri:0,level:'elevated',label:b.label,color:b.color,bg:'var(--cream)',icon:b.icon,title:`Behaviour Detected: ${b.label}`,desc:b.desc,time:new Date().toLocaleTimeString(),category:'behaviour',signals:[]};
  alertLogData.unshift(alertEntry);
  showToast(b.icon+' '+b.label+' Detected',b.desc,'elevated');
}

function clearCanvas(id){const c=document.getElementById(id);if(c){const ctx=c.getContext('2d');ctx.clearRect(0,0,c.width,c.height);}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HISTORY PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let historyTab='7d';
function buildHistoryPage(){
  const days=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const hriData=[18,22,35,28,19,45,68];
  const events=[0,0,1,0,0,2,alertCounts.total||0];
  const avg=Math.round(hriData.reduce((a,b)=>a+b,0)/hriData.length);
  const peak=Math.max(...hriData);
  document.getElementById('tr-avg').textContent=avg;
  document.getElementById('tr-peak').textContent=peak;
  document.getElementById('tr-events').textContent=events.reduce((a,b)=>a+b,0)+alertCounts.total;
  drawHistoryChart('hri-trend-chart',days,hriData,'#0A7B6C');
  drawBarChart('sig-avg-chart');
  drawTempHistoryChart();
  drawStepsHistoryChart();
  // Daily summary
  const ds=document.getElementById('daily-summary');ds.innerHTML='';
  const stepData=[3200,6800,8100,4500,9200,5600,totalSteps];
  days.forEach((d,i)=>{
    const v=hriData[i];const c=v<=30?'#1A7B4A':v<=55?'#C97B1A':v<=75?'#B85A00':'#C0392B';
    ds.innerHTML+=`<div class="day-row"><span class="day-label">${d}</span><div class="day-bar-track"><div class="day-bar-fill" style="width:${v}%;background:${c}"></div></div><span class="day-score" style="color:${c}">${v}</span><span class="day-events" style="font-size:.65rem;color:var(--ink3)">üë£ ${stepData[i].toLocaleString()}</span><span class="day-events">${events[i]?events[i]+' alert':'‚Äî'}</span></div>`;
  });
  const patterns=[
    {title:'üß¨ HR-HRV Coupling',color:TEAL,bg:'var(--teal-lt)',desc:'Strong inverse correlation (r=‚àí0.78). Normal autonomic function.'},
    {title:'ü©µ SpO‚ÇÇ Stability',color:'#1A5C9C',bg:'var(--blue-lt)',desc:'Oxygen stable at 98.2¬±0.4%. No hypoxia risk.'},
    {title:'üå°Ô∏è Temperature Trend',color:AMBER,bg:'var(--amber-lt)',desc:'Slight elevation Sunday afternoon. Correlated with elevated HR.'},
    {title:'üë£ Activity Pattern',color:TEAL,bg:'var(--teal-lt)',desc:'Average 5,800 steps/day. Below 10K goal on 5/7 days.'},
  ];
  const pg=document.getElementById('pattern-grid');pg.innerHTML='';
  patterns.forEach(p=>{pg.innerHTML+=`<div class="pattern-card" style="background:${p.bg};border-color:${p.color}40"><div class="pattern-card-title" style="color:${p.color}">${p.title}</div><div class="pattern-card-body">${p.desc}</div></div>`;});
}

function drawTempHistoryChart(){
  const canvas=document.getElementById('temp-trend-chart');if(!canvas)return;
  const dpr=window.devicePixelRatio||1;const W=canvas.offsetWidth||300,H=160;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);ctx.clearRect(0,0,W,H);
  const labels=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const data=[36.8,36.9,37.1,38.2,37.6,36.8,36.9];
  const pad={t:10,b:30,l:8,r:8};const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  const mn=36,mx=39.5;const n=data.length;
  // Fever threshold band
  const fy=pad.t+(1-(38-mn)/(mx-mn))*cH;
  ctx.fillStyle='rgba(192,57,43,.06)';ctx.fillRect(pad.l,pad.t,cW,fy-pad.t);
  ctx.strokeStyle='rgba(192,57,43,.3)';ctx.lineWidth=1;ctx.setLineDash([4,4]);
  ctx.beginPath();ctx.moveTo(pad.l,fy);ctx.lineTo(W-pad.r,fy);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='rgba(192,57,43,.6)';ctx.font='9px Instrument Sans';ctx.fillText('Fever 38¬∞C',pad.l+4,fy-3);
  data.forEach((v,i)=>{
    const x=pad.l+(i/(n-1))*cW;const y=pad.t+(1-(v-mn)/(mx-mn))*cH;
    const c=v>=38?RED:v>=37.5?AMBER:TEAL;
    ctx.fillStyle=c;ctx.beginPath();ctx.arc(x,y,5,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='rgba(26,20,16,.5)';ctx.font='10px Instrument Sans';ctx.textAlign='center';ctx.fillText(labels[i],x,H-pad.b+14);
    ctx.fillStyle=c;ctx.font='bold 9px Instrument Sans';ctx.fillText(v.toFixed(1),x,y-8);
  });
  // Line
  ctx.strokeStyle=AMBER;ctx.lineWidth=2;ctx.beginPath();
  data.forEach((v,i)=>{const x=pad.l+(i/(n-1))*cW;const y=pad.t+(1-(v-mn)/(mx-mn))*cH;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});ctx.stroke();
}

function drawStepsHistoryChart(){
  const canvas=document.getElementById('steps-chart');if(!canvas)return;
  const dpr=window.devicePixelRatio||1;const W=canvas.offsetWidth||300,H=160;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);ctx.clearRect(0,0,W,H);
  const labels=['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const data=[3200,6800,8100,4500,9200,5600,totalSteps||2100];
  const goal=todayStepGoal;
  const pad={t:10,b:28,l:8,r:8};const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  const n=data.length;const mx=12000;
  const barW=Math.max(cW/n*0.6,16);const gap=(cW-(barW*n))/(n+1);
  // Goal line
  const gy=pad.t+(1-goal/mx)*cH;
  ctx.strokeStyle='rgba(10,123,108,.4)';ctx.lineWidth=1;ctx.setLineDash([4,4]);
  ctx.beginPath();ctx.moveTo(pad.l,gy);ctx.lineTo(W-pad.r,gy);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='rgba(10,123,108,.7)';ctx.font='9px Instrument Sans';ctx.fillText('Goal',pad.l+4,gy-3);
  data.forEach((v,i)=>{
    const x=pad.l+gap+(barW+gap)*i;const bH=(v/mx)*cH;const y=pad.t+cH-bH;
    const c=v>=goal?TEAL:v>=goal*0.75?AMBER:RED;
    const grad=ctx.createLinearGradient(0,y,0,y+bH);grad.addColorStop(0,c);grad.addColorStop(1,c+'80');
    ctx.fillStyle=grad;ctx.beginPath();
    ctx.moveTo(x+4,y);ctx.lineTo(x+barW-4,y);ctx.quadraticCurveTo(x+barW,y,x+barW,y+4);
    ctx.lineTo(x+barW,y+bH);ctx.lineTo(x,y+bH);ctx.lineTo(x,y+4);ctx.quadraticCurveTo(x,y,x+4,y);ctx.closePath();ctx.fill();
    ctx.fillStyle='rgba(26,20,16,.5)';ctx.font='9px Instrument Sans';ctx.textAlign='center';ctx.fillText(labels[i],x+barW/2,H-pad.b+12);
  });
}

function drawHistoryChart(id,labels,data,color){
  const canvas=document.getElementById(id);if(!canvas)return;
  const dpr=window.devicePixelRatio||1;const W=canvas.offsetWidth||600,H=120;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);ctx.clearRect(0,0,W,H);
  const pad={t:10,b:30,l:8,r:8};const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;const n=data.length;
  const bands=[{from:0,to:.3,c:'#1A7B4A08'},{from:.3,to:.55,c:'#C97B1A08'},{from:.55,to:1,c:'#C0392B08'}];
  bands.forEach(b=>{ctx.fillStyle=b.c;ctx.fillRect(pad.l,pad.t+cH*(1-b.to),cW,cH*(b.to-b.from));});
  [25,50,75].forEach(v=>{const y=pad.t+(1-v/100)*cH;ctx.strokeStyle='rgba(26,20,16,.06)';ctx.lineWidth=1;ctx.setLineDash([4,4]);ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();});ctx.setLineDash([]);
  const grad=ctx.createLinearGradient(0,pad.t,0,H-pad.b);grad.addColorStop(0,color+'40');grad.addColorStop(1,color+'00');
  ctx.fillStyle=grad;ctx.beginPath();ctx.moveTo(pad.l,pad.t+cH);
  for(let i=0;i<n;i++){const x=pad.l+(i/(n-1))*cW;const y=pad.t+(1-data[i]/100)*cH;i===0?ctx.lineTo(x,y):ctx.lineTo(x,y);}
  ctx.lineTo(W-pad.r,pad.t+cH);ctx.closePath();ctx.fill();
  ctx.strokeStyle=color;ctx.lineWidth=2;ctx.lineCap='round';ctx.beginPath();
  for(let i=0;i<n;i++){const x=pad.l+(i/(n-1))*cW;const y=pad.t+(1-data[i]/100)*cH;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();
  for(let i=0;i<n;i++){const x=pad.l+(i/(n-1))*cW;const y=pad.t+(1-data[i]/100)*cH;ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fill();ctx.strokeStyle=color;ctx.lineWidth=2;ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.stroke();ctx.fillStyle='rgba(26,20,16,.5)';ctx.font='10px Instrument Sans';ctx.textAlign='center';ctx.fillText(labels[i],x,H-pad.b+14);}
}

function drawBarChart(id){
  const canvas=document.getElementById(id);if(!canvas)return;
  const dpr=window.devicePixelRatio||1;const W=canvas.offsetWidth||300,H=160;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);ctx.clearRect(0,0,W,H);
  const sigs=SIGNALS.filter(s=>s.key!=='steps'&&s.key!=='fever');
  const pad={t:8,b:28,l:8,r:8};const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;const n=sigs.length;
  const barW=Math.max(cW/n*0.55,16);const gap=(cW-(barW*n))/(n+1);
  sigs.forEach((s,i)=>{const x=pad.l+gap+(barW+gap)*i;const pct=(s.base-s.range[0])/(s.range[1]-s.range[0]);const bH=pct*cH;const y=pad.t+cH-bH;const grad=ctx.createLinearGradient(0,y,0,y+bH);grad.addColorStop(0,s.color);grad.addColorStop(1,s.color+'80');ctx.fillStyle=grad;ctx.beginPath();const r=4;ctx.moveTo(x+r,y);ctx.lineTo(x+barW-r,y);ctx.quadraticCurveTo(x+barW,y,x+barW,y+r);ctx.lineTo(x+barW,y+bH);ctx.lineTo(x,y+bH);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();ctx.fill();ctx.fillStyle='rgba(26,20,16,.5)';ctx.font='9px Instrument Sans';ctx.textAlign='center';ctx.fillText(s.short,x+barW/2,H-pad.b+12);});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SETTINGS SECTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showSettingsSection(id,btn){
  document.querySelectorAll('.settings-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.settings-nav-item').forEach(b=>b.classList.remove('active'));
  document.getElementById('ss-'+id).classList.add('active');
  btn.classList.add('active');
}
function setProto(p,btn){
  document.querySelectorAll('.proto-tab').forEach(b=>b.classList.remove('active'));btn.classList.add('active');
  const msgs={ble:'Scanning for BLE devices... Make sure your ESP32 is in pairing mode.',wifi:'Enter your MQTT broker address and click Connect.',usb:'Connect ESP32 via USB. Select COM port and click Connect.',demo:'Demo mode active ‚Äî simulated sensor data streaming at 10 Hz'};
  const bar=document.getElementById('conn-status');
  bar.innerHTML=`<div class="live-dot" style="background:${p==='demo'?'var(--teal2)':'var(--amber)'};box-shadow:0 0 6px ${p==='demo'?'var(--teal2)':'var(--amber)'}"></div><span>${msgs[p]}</span>`;
}
function simulateConnect(){
  const addr=document.getElementById('conn-addr').value.trim()||'ESP32-PulseIQ';
  document.getElementById('conn-status').innerHTML=`<div class="live-dot"></div><span>Connected to ${addr} ‚Äî streaming at 10 Hz</span>`;
  showToast('üì° Connected','Sensor stream active: '+addr,'normal');
}
function toggleSensor(id,card){
  const isConnected=card.classList.contains('connected');
  card.className='sensor-card '+(isConnected?'searching':'connected');
  const s=card.querySelector('.sensor-status');
  s.textContent=isConnected?'‚óå Searching...':'‚óè Connected';
  s.className='sensor-status '+(isConnected?'search':'ok');
  showToast('üì° Sensor '+(isConnected?'Disconnected':'Reconnected'),id.toUpperCase(),(isConnected?'elevated':'normal'));
}
function updateTempUnit(){
  const unit=document.getElementById('temp-unit').value;
  showToast('‚öôÔ∏è Temperature Unit','Now showing in ¬∞'+unit,'normal');
}
function updateStepGoal(val){
  todayStepGoal=parseInt(val);
  document.getElementById('step-goal-val').textContent=parseInt(val).toLocaleString();
  updateStepsUI();
}
function exportData(){
  const data={patient:document.getElementById('p-name')?.textContent||'Alex Kumar',exportedAt:new Date().toISOString(),signals:SIGNALS.map(s=>({key:s.key,base:s.base,lo:s.lo,hi:s.hi})),alertCount:alertCounts,stepsToday:totalSteps};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='pulseiq-export.json';a.click();URL.revokeObjectURL(url);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PROFILE EDIT MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openEditModal(section){
  document.getElementById('edit-modal').classList.add('show');
}
function closeEditModal(){document.getElementById('edit-modal').classList.remove('show');}
function saveProfile(){
  const first=document.getElementById('edit-first').value.trim();
  const last=document.getElementById('edit-last').value.trim();
  const full=`${first} ${last}`;
  const initials=(first[0]||'')+(last[0]||'');
  const age=document.getElementById('edit-age').value;
  const gender=document.getElementById('edit-gender').value;
  const height=document.getElementById('edit-height').value;
  const weight=document.getElementById('edit-weight').value;
  const bmi=(weight/((height/100)**2)).toFixed(1);
  const pid=document.getElementById('edit-pid').value;
  // Update all display elements
  document.getElementById('nav-name').textContent=full;
  document.getElementById('nav-avatar').textContent=initials;
  document.getElementById('nav-pid').textContent=pid+' ¬∑ Edit ‚úèÔ∏è';
  document.getElementById('profile-name').textContent=full;
  document.getElementById('profile-id').textContent='Patient ID: '+pid+' ¬∑ Joined Jan 2024';
  document.getElementById('profile-avatar-lg').textContent=initials;
  document.getElementById('p-age').textContent=age+' years';
  document.getElementById('p-gender').textContent=gender;
  document.getElementById('p-height').textContent=height+' cm';
  document.getElementById('p-weight').textContent=weight+' kg';
  document.getElementById('p-bmi').textContent=bmi;
  document.getElementById('p-blood').textContent=document.getElementById('edit-blood').value;
  document.getElementById('p-conditions').textContent=document.getElementById('edit-conditions').value;
  document.getElementById('p-medications').textContent=document.getElementById('edit-medications').value;
  document.getElementById('p-allergies').textContent=document.getElementById('edit-allergies').value;
  document.getElementById('p-emergency').textContent=document.getElementById('edit-emergency').value;
  document.getElementById('p-physician').textContent=document.getElementById('edit-physician').value;
  closeEditModal();
  showToast('‚úÖ Profile Saved','Your profile has been updated successfully','normal');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WELLNESS ACTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function addSteps(){
  const n=parseInt(prompt('How many steps to add?','500')||0);
  if(n>0){totalSteps+=n;updateStepsUI();showToast('üë£ Steps Added',`+${n} steps. Total: ${totalSteps.toLocaleString()}`,'normal');}
}
function addWater(){
  waterCount++;
  document.getElementById('g-water').textContent=`${waterCount} / 8`;
  document.getElementById('gbar-water').style.width=Math.min(waterCount/8*100,100)+'%';
  showToast('üíß Water Logged',`${waterCount}/8 glasses today. ${waterCount>=8?'Goal reached! üéâ':'Keep it up!'}`,'normal');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAV & PAGE CONTROLS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showPage(page,navBtn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  navBtn.classList.add('active');
  if(page==='history')setTimeout(buildHistoryPage,100);
  if(page==='mic')buildBehaviourPanel();
}
function setScenario(sc,btn){
  scenario=sc;scenTick=0;
  document.querySelectorAll('.scenario-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');
  showToast('üß™ Scenario: '+sc.charAt(0).toUpperCase()+sc.slice(1),'Simulating '+sc+' physiological pattern','normal');
}
function setHistoryTab(tab,btn){historyTab=tab;document.querySelectorAll('.history-tab').forEach(b=>b.classList.remove('active'));btn.classList.add('active');buildHistoryPage();}
function togglePause(){
  paused=!paused;const btn=document.getElementById('pause-btn');
  btn.textContent=paused?'‚ñ∂ Resume':'‚è∏ Pause';
  btn.className=paused?'btn btn-primary btn-sm':'btn btn-ghost btn-sm';
}
function resetAll(){
  SIGNALS.forEach(s=>bufs[s.key].fill(s.base));
  scenario='normal';scenTick=0;totalSamples=0;sessionStart=Date.now();
  lastAlertLevel='normal';lastAlertMs=0;totalSteps=0;waterCount=0;
  document.querySelectorAll('.scenario-btn').forEach(b=>b.classList.remove('active'));
  document.querySelector('.scenario-btn.full').classList.add('active');
  updateStepsUI();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let toastTimer=null;
function showToast(title,msg,level){
  const icons={elevated:'‚ö†Ô∏è',high:'‚ö°',critical:'üö®',emergency:'üÜò',normal:'‚úì'};
  document.getElementById('toast-icon').textContent=icons[level]||'üîî';
  document.getElementById('toast-title').textContent=title;
  document.getElementById('toast-msg').textContent=msg;
  const t=document.getElementById('toast');t.classList.add('show');
  if(toastTimer)clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),4500);
}
function hideToast(){document.getElementById('toast').classList.remove('show');}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
buildSignalGrid();
buildCorrGrid();
buildBaselineBars();
buildSensorGrid();
buildThresholdSettings();
buildBehaviourPanel();
drawHRI(0);
// Initial step count
totalSteps=Math.round(Math.random()*3000+1000);
updateStepsUI();
setInterval(update,100);
window.addEventListener('resize',()=>{SIGNALS.filter(s=>s.key!=='steps').forEach(s=>drawMini(s.key));if(document.getElementById('page-history').classList.contains('active'))buildHistoryPage();});
// Close modal on overlay click
document.getElementById('edit-modal').addEventListener('click',function(e){if(e.target===this)closeEditModal();});
</script>
</body>
</html>
